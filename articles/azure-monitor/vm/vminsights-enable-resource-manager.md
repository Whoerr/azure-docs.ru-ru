---
title: Включение аналитики виртуальной машины с помощью шаблонов диспетчер ресурсов
description: В этой статье описывается, как включить аналитику VM для одной или нескольких виртуальных машин Azure или масштабируемых наборов виртуальных машин с помощью Azure PowerShell или шаблонов Azure Resource Manager.
ms.subservice: ''
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 07/27/2020
ms.openlocfilehash: 57e2649dfe651bfa1e2ef18ff52ca611c122d696
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101707495"
---
# <a name="enable-vm-insights-using-resource-manager-templates"></a>Включение аналитики виртуальной машины с помощью шаблонов диспетчер ресурсов
В этой статье описывается, как включить аналитику VM для виртуальной машины или масштабируемого набора виртуальных машин с помощью шаблонов диспетчер ресурсов. Эту процедуру можно использовать для следующих действий:

- Виртуальная машина Azure
- Масштабируемый набор виртуальных машин Azure
- Гибридная виртуальная машина, подключенная к службе "Дуга Azure"

## <a name="prerequisites"></a>Предварительные требования

- [Создание и Настройка рабочей области log Analytics](./vminsights-configure-workspace.md). 
- Ознакомьтесь с [поддерживаемыми операционными системами](./vminsights-enable-overview.md#supported-operating-systems) , чтобы убедиться, что операционная система, которую вы включаете, поддерживается. 

## <a name="resource-manager-templates"></a>Шаблоны Resource Manager

Мы создали пример Azure Resource Manager шаблоны для адаптации виртуальных машин и масштабируемых наборов виртуальных машин. Эти шаблоны включают сценарии, которые можно использовать для включения наблюдения за существующим ресурсом и создания нового ресурса с включенным наблюдением.

>[!NOTE]
>Шаблон должен быть развернут в той же группе ресурсов, что и включенная виртуальная машина или масштабируемый набор виртуальных машин.


Шаблоны Azure Resource Manager предоставляются в файле архива (ZIP-файл), который можно [скачать](https://aka.ms/VmInsightsARMTemplates) из нашего репозитория GitHub. Содержимое файла включает папки, представляющие каждый сценарий развертывания с шаблоном и файлом параметров. Прежде чем запускать их, измените файл параметров и укажите необходимые значения. 

Загружаемый файл содержит следующие шаблоны для различных сценариев.

- Шаблон **ексистингвмонбоардинг** позволяет выполнять аналитику ВМ, если виртуальная машина уже существует.
- Шаблон **неввмонбоардинг** создает виртуальную машину и позволяет отслеживать ее с помощью VM Insights.
- Шаблон **ексистингвмссонбоардинг** позволяет выполнять аналитику ВМ, если масштабируемый набор виртуальных машин уже существует.
- Шаблон **неввмссонбоардинг** создает масштабируемые наборы виртуальных машин и позволяет отслеживать их с помощью VM Insights.
- Шаблон **конфигуреворкспаце** настраивает log Analytics рабочей области для поддержки аналитики виртуальной машины, включая решения и коллекцию счетчиков производительности операционных систем Linux и Windows.

>[!NOTE]
>Если масштабируемые наборы виртуальных машин уже присутствовали и для политики обновления задано значение **вручную**, то по умолчанию служба "аналитика VM" не будет включена для экземпляров после запуска шаблона Azure Resource Manager **ексистингвмссонбоардинг** . Экземпляры необходимо обновить вручную.

## <a name="deploy-templates"></a>Развертывание шаблонов
Шаблоны можно развернуть с помощью [любого метода развертывания для Диспетчер ресурсов шаблонов](../../azure-resource-manager/templates/deploy-powershell.md) , включая следующие примеры с помощью POWERSHELL и CLI.

```powershell
New-AzResourceGroupDeployment -Name OnboardCluster -ResourceGroupName <ResourceGroupName> -TemplateFile <Template.json> -TemplateParameterFile <Parameters.json>
```


```azurecli
az deployment group create --resource-group <ResourceGroupName> --template-file <Template.json> --parameters <Parameters.json>
```



## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда наблюдение включено для виртуальных машин, эти сведения доступны для анализа с помощью VM Insights.

- Чтобы просмотреть зависимости обнаруженных приложений, см. статью [Просмотр схемы VM Insights](vminsights-maps.md).

- Чтобы определить узкие места и общее использование с производительностью виртуальной машины, см. статью [Просмотр производительности виртуальной машины Azure](vminsights-performance.md).