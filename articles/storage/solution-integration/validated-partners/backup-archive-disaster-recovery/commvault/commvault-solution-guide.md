---
title: Резервное копирование данных в Azure с помощью Commvault
titleSuffix: Azure Blob Storage Docs
description: На веб-странице приводятся общие сведения о факторах, которые необходимо учитывать, и действия, которые необходимо выполнить, чтобы использовать Azure в качестве целевого объекта хранилища и расположения восстановления для Commvault Complete Backup и Recovery
keywords: Commvault, резервное копирование в облако, архивация, резервное копирование в Azure, аварийное восстановление, непрерывность бизнес-процессов
author: Karl Rautenstrauch
ms.author: karauten
ms.date: 11/11/2020
ms.topic: article
ms.service: Storage
ms.subservice: Blob Storage
ms.openlocfilehash: f5b35abd58d99478014c1227b6e3c03c2fc7a177
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101746199"
---
# <a name="back-up-to-azure-with-commvault"></a>Резервное копирование в Azure с помощью Commvault

В этой статье представлено руководство по интеграции инфраструктуры Commvault с хранилищем BLOB-объектов Azure. Сюда входят предварительные требования, принципы хранения Azure, их реализация и руководство по эксплуатации. В этой статье рассматривается только использование Azure в качестве целевого объекта резервного копирования и сайта восстановления в случае аварии, что предотвращает нормальную работу на основном сайте. Commvault также предлагает более низкое решение RTO, Commvault Live Sync, как средство резервной виртуальной машины, готовой к загрузке и восстановлению в случае аварии и защиты ресурсов в рабочей среде Azure. Эти возможности выходят за рамки данного документа. 

## <a name="reference-architecture-for-on-premises-to-azure-and-in-azure-deployments"></a>Эталонная архитектура для развертывания из локальной среды в Azure и In-Azure

![Commvault на эталонную архитектуру Azure](../media/commvault-diagram.png)

Существующее развертывание Commvault можно легко интегрировать с Azure, добавив учетную запись хранения Azure или несколько учетных записей в качестве целевого объекта облачного хранилища. Commvault также позволяет восстанавливать резервные копии из локальной среды в Azure, предоставляя сайт восстановления по запросу в Azure.   

## <a name="commvault-interoperability-matrix"></a>Матрица взаимодействия Commvault
| Рабочая нагрузка | GPv2 и хранилище BLOB-объектов | Поддержка замечательных уровней | Поддержка уровня архива | Поддержка семейства Data Box |
|-----------------------|--------------------|--------------------|-------------------------|-------------------------|
| Локальные виртуальные машины и данные | v 11,5 | v 11,5 | v 11.10 | v 11.10 |
| Виртуальные машины Azure | v 11,5 | v 11,5 | v 11,5 | Н/Д |
| Большой двоичный объект Azure | v 11.6 | v 11.6 | v 11.6 | Н/Д |
| Файлы Azure | v 11.6 | v 11.6 | v 11.6 | Н/Д | 

## <a name="before-you-begin"></a>Перед началом

Небольшое предварительное планирование позволит вам присоединиться к рангам множества, многих счастливых клиентов, использующих Azure в качестве автономного целевого объекта архивации и сайта восстановления.

### <a name="are-you-new-to-azure"></a>Вы впервые используете Azure?

Корпорация Майкрософт предлагает платформу для работы с Azure. [Инфраструктура внедрения в облако](https://docs.microsoft.com/azure/architecture/cloud-adoption/) \( КАФ \) — это подробный подход к корпоративному преобразованию и исчерпывающему руководству по планированию внедрения в облако. КАФ содержит пошаговое [руководств по установке Azure](https://docs.microsoft.com/azure/cloud-adoption-framework/ready/azure-setup-guide/) , которые помогут вам быстро и безопасно приступить к работе, а также найти интерактивную версию на [портале Azure](https://portal.azure.com/?feature.quickstart=true#blade/Microsoft_Azure_Resources/QuickstartCenterBlade). Вы найдете примеры архитектур и рекомендации по развертыванию приложений и бесплатных учебных материалов, чтобы получить сведения о пути к Azure.

### <a name="consider-the-network-between-your-location-and-azure"></a>Рассмотрим сеть между расположением и Azure

Независимо от того, используете ли облачные ресурсы для запуска рабочей среды, тестирования и разработки, а также резервное копирование и сайт восстановления, важно понимать требования к пропускной способности при начальном заполнении резервных копий и переходе на повседневную передачу. 

Azure Data Box предоставляет средства для передачи исходного базового плана резервного копирования в Azure без дополнительной пропускной способности, если предполагается, что запланированная скорость займет больше времени, чем можно будет допускать. Вы можете использовать средство оценки Передача данных при создании учетной записи хранения, чтобы оценить время, необходимое для перемещения начальной резервной копии.

![Оценщик Передача данных хранилища Azure](../media/az-storage-transfer.png)

Помните, что для поддержки ежедневной передачи данных в обязательном окне передачи (окно резервного копирования) потребуется достаточный объем сети, не затрагивая рабочие приложения. В этом разделе описаны средства и методы, доступные для оценки потребностей сети.

#### <a name="how-can-you-determine-how-much-bandwidth-you-will-need"></a>Как можно определить, сколько пропускной способности потребуется?

-  Отчеты из программного обеспечения для резервного копирования. 
  Commvault предоставляет стандартные отчеты для определения [частоты изменений](https://documentation.commvault.com/commvault/v11_sp19/article?p=39699.htm) и [общего размера резервного набора данных](https://documentation.commvault.com/commvault/v11_sp19/article?p=39621.htm) для начальной передачи базовых показателей в Azure.
- Резервное копирование программно-независимых средств оценки и создания отчетов, например:
  - [митренд](https://mitrend.com/)
  - [аптаре](https://www.veritas.com/insights/aptare-it-analytics)
  - [датавосс](https://www.datavoss.com/)

#### <a name="how-will-i-know-how-much-headroom-i-have-with-my-current-internet-connection"></a>Как узнать, какой запас у меня есть у меня в текущем подключении к Интернету?

Важно иметь представление о том, насколько широка или обычно не используется пропускная способность, доступная на ежедневной основе. Это позволит вам правильно оценить, можно ли удовлетворить поставленные цели, когда вы не используете Azure Data Box для заполнения в автономном режиме, а также для выполнения ежедневного резервного копирования на основе указанной выше скорости изменения и окна резервного копирования. Ниже приведены методы, которые можно использовать для задания объема пропускной способности, необходимой для использования резервных копий в Azure.

- Вы уже являетесь клиентом Azure ExpressRoute? Просмотрите сведения [об использовании канала](https://docs.microsoft.com/azure/expressroute/expressroute-monitoring-metrics-alerts#circuits-metrics) в портал Azure.
- Вы можете обратиться к поставщику услуг Интернета. Они должны иметь отчеты, которые помогут вам поделиться существующим ежедневным и ежемесячным использованием.
- Существует несколько средств, которые могут измерять использование за счет мониторинга сетевого трафика на уровне маршрутизатора или коммутатора, в том числе:
  - [Пакет анализатора пропускной способности соларвиндс](https://www.solarwinds.com/network-bandwidth-analyzer-pack?CMP=ORG-BLG-DNS)
  - [Паесслер ПРТГ](https://www.paessler.com/bandwidth_monitoring)
  - [Помощник по сети Cisco](https://www.cisco.com/c/en/us/products/cloud-systems-management/network-assistant/index.html)
  - [Вхатсуп Gold](https://www.whatsupgold.com/network-traffic-monitoring)

### <a name="choosing-the-right-storage-options"></a>Выбор правильных вариантов хранения

При использовании Azure в качестве целевого объекта резервного копирования клиенты используют [хранилище BLOB-объектов Azure](https://docs.microsoft.com/azure/storage/blobs/storage-blobs-introduction) .\. Хранилище BLOB-объектов Azure — это решение для хранения объектов Майкрософт. Хранилище BLOB-объектов оптимизировано для хранения огромных объемов неструктурированных данных, которые не соответствуют ни одной модели данных или определению. Кроме того, служба хранилища Azure является устойчивой, высокодоступной, безопасной и масштабируемой. Платформа Майкрософт предлагает гибкие возможности выбора подходящего хранилища для правильной рабочей нагрузки, чтобы обеспечить [уровень устойчивости](https://docs.microsoft.com/azure/storage/common/storage-redundancy?toc=/azure/storage/blobs/toc.json) для удовлетворения внутренних соглашений об уровне обслуживания. Хранилище BLOB-объектов — это служба оплаты за использование. Вы платите [ежемесячно](https://docs.microsoft.com/azure/storage/blobs/storage-blob-storage-tiers?tabs=azure-portal#pricing-and-billing) за объем хранящихся данных, доступ к этим данным и, в случае с уровнями "крутой" и "архивный", минимально необходимый срок хранения. Параметры устойчивости и уровней, применимые к данным резервных копий, приведены в таблицах ниже.

**Варианты устойчивости хранилища BLOB-объектов Azure:**

|  |Локально избыточное хранилище  |Избыточная зона  |Географически избыточное  |Избыточная геозона  |
|---------|---------|---------|---------|---------|
|Действующие числа копий     | 3         | 3         | 6         | 6 |
|число Зоны доступности     | 1         | 3         | 2         | 4 |
|число регионов     | 1         | 1         | 2         | 2 |
|Переход на другой ресурс вручную в дополнительный регион     | Н/Д         | Н/Д         | Да         | Да |

**Уровни хранилища BLOB-объектов Azure:**

|  | Горячий уровень   |Изящный уровень   | Уровень архива |
| ----------- | ----------- | -----------  | -----------  |
| Доступность | 99,9 %         | 99 %         | Автономная миграция      |
| Плата за использование | Более высокие затраты на хранение, снижение уровня доступа и затраты на транзакции | Ниже стоимость хранения, выше расходы на доступ и транзакции | Ниже стоимость хранения, очень высокие расходы на доступ и транзакции |
| Требуется минимальное хранение данных | Н/Д | 30 дней | 180 дней |
| Задержка (время до первого байта) | Миллисекунды | Миллисекунды | Часы |

#### <a name="sample-backup-to-azure-cost-model"></a>Пример резервного копирования в модель стоимости Azure

Концепция оплаты за использование может быть непростой для клиентов, которые не знакомы с общедоступным облаком. Хотя вы платите только за используемую емкость, вы также платите за транзакции (чтение и запись) и исходящий трафик [для данных](https://azure.microsoft.com/pricing/details/bandwidth/) , считанных в локальную среду, когда используется [неограниченный локальный тариф Azure Express Route или план данных с прямым маршрутом](https://azure.microsoft.com/pricing/details/expressroute/) , где включены данные из Azure. Вы можете выполнить анализ на основе цен на список или с помощью [зарезервированных ресурсов службы хранилища Azure](https://docs.microsoft.com/azure/cost-management-billing/reservations/save-compute-costs-reservations), которые могут доставлять до 38% экономии в [калькуляторе цен Azure](https://azure.microsoft.com/pricing/calculator/). Ниже приведен пример использования ценовой категории для моделирования ежемесячных затрат на резервное копирование в Azure. это только пример, и ***ваши цены могут отличаться в зависимости от действий, которые не были захвачены:***


|Коэффициент стоимости  |Ежемесячные расходы  |
|---------|---------|
|100 ТБ данных резервного копирования в очень удобном хранилище     |$1556,48         |
|2 ТБ новых данных, записанных в день x 30 дней     |$39 в транзакциях          |
|Ежемесячная оценочная сумма     |$1595,48         |
|---------|---------|
|Восстановление из 5 ТБ в локальную сеть через общедоступный Интернет   | $491,26         |


> [!Note] 
Эта оценка была создана в калькуляторе цен Azure с использованием Восточной цены с оплатой по мере использования и основана на Commvault по умолчанию для размера подфрагмента 32 МБ, который формирует 65 536 запросов на размещение, то есть транзакций записи в день. Этот пример может быть неприменим к вашим требованиям.

## <a name="implementation-and-operational-guidance"></a>Руководство по реализации и эксплуатации

В этом разделе содержится краткое описание добавления службы хранилища Azure в локальное развертывание Commvault. Если вы хотите получить подробные рекомендации и рекомендации по планированию, рекомендуем ознакомиться с [руководством по архитектуре Commvault Azure](https://www.commvault.com/resources/public-cloud-architecture-guide-for-microsoft-azure-v11-sp16).

1. Откройте портал Azure и выполните поиск по фразе "учетные записи хранения" или щелкните значок служб по умолчанию.
    
    1. ![Портал Azure](../media/azure-portal.png)
  
    1. ![Учетные записи хранения на портале Azure](../media/locate-storage-account.png)

2. Выберите Добавление учетной записи, а также выберите или создайте группу ресурсов, укажите уникальное имя, выберите регион, выберите "Стандартная" производительность, всегда оставляйте тип учетной записи как "хранилище v2", выберите уровень репликации, который соответствует соглашениям об уровне обслуживания, и уровень по умолчанию, который будет использоваться по резервному копированию. Учетная запись хранения Azure делает неактивные, интересные и архивные уровни, доступные в рамках одной учетной записи, а политики Commvault позволяют использовать несколько уровней для эффективного управления жизненным циклом данных. Перейдите к следующему шагу. 

    ![Создание учетной записи хранения](../media/account-create-1.png)

3. Задерживайте параметры сети по умолчанию и перейдите к «Data Protection». Здесь можно включить "обратимое удаление", которое позволяет восстанавливать случайно удаленный файл резервной копии в течение определенного срока хранения и обеспечивает защиту от случайного или вредоносного удаления. 
    
    ![Создание учетной записи хранения, часть 2](../media/account-create-2.png)

4. Далее мы рекомендуем использовать параметры по умолчанию на экране "Дополнительно" для резервного копирования в сценарии использования Azure.

    ![Создание учетной записи хранения, часть 3](../media/account-create-3.png) 

5. Добавьте теги для Организации, если вы используете метки и создаете свою учетную запись. Теперь у вас есть петабайтовное хранилище по запросу.

6. Прежде чем добавлять учетную запись в среду Commvault, необходимо выполнить два быстрых действия. Перейдите к учетной записи, созданной в портал Azure, и выберите "контейнеры" в меню "Служба BLOB-объектов" в колонке портала. Добавьте новый контейнер и выберите понятное имя. Затем перейдите к элементу "ключи доступа" в разделе "Параметры" и скопируйте "имя учетной записи хранения" и один из двух ключей доступа. В следующих шагах потребуется имя контейнера, имя учетной записи и ключ доступа.
    
    ![Создание контейнера](../media/container.png)
    
    ![Получение сведений об учетной записи](../media/access-key.png)

7. ***(Необязательно)*** В развертывание можно добавить дополнительные уровни безопасности.
    
    1. Настройте доступ на основе ролей, чтобы ограничить пользователей, которые могут вносить изменения в учетную запись хранения. [Дополнительные сведения см. здесь](https://docs.microsoft.com/azure/storage/common/authorization-resource-provider?toc=/azure/storage/blobs/toc.json)
    1. Ограничьте доступ к учетной записи на определенные сегменты сети с помощью [брандмауэра хранилища](https://docs.microsoft.com/azure/storage/common/storage-network-security?toc=%2Fazure%2Fstorage%2Fblobs%2Ftoc.json&tabs=azure-portal) , чтобы предотвратить попытки доступа за пределами корпоративной сети.

    ![Брандмауэр хранилища](../media/storage-firewall.png) 

    1. Установите [блокировку удаления](https://docs.microsoft.com/azure/azure-resource-manager/management/lock-resources) для учетной записи, чтобы предотвратить случайное удаление учетной записи хранения.

    ![Блокировка ресурса](../media/resource-lock.png)
    
    1. Настройте дополнительные рекомендации по [обеспечению безопасности](https://docs.microsoft.com/azure/storage/blobs/security-recommendations).
    
1. В центре команд Commvault перейдите в раздел "Управление"--> "безопасность"--> "Диспетчер учетных данных". Выберите "облачная учетная запись", "тип поставщика" служба хранилища Microsoft Azure выберите "Медиаажент", который будет передавать данные в Azure и обратно, добавить имя учетной записи хранения и ключ доступа.
    
    ![Учетные данные Commvault](../media/commvault-credential.png)

9. Затем перейдите в раздел "хранилище" — > "облако" в центре команд Commvault. Выберите "Добавить". Введите понятное имя для учетной записи хранения, а затем выберите "служба хранилища Microsoft Azure" из списка "тип". Выберите сервер агента мультимедиа, который будет использоваться для передачи резервных копий в службу хранилища Azure. Добавьте созданный контейнер, выберите уровень хранилища, который будет использоваться в учетной записи хранения Azure, и выберите учетные данные, созданные на шаге #8. Наконец, выберите, следует ли передавать недублированные резервные копии или нет, а также расположение базы данных дедупликации.
    
     ![Добавление хранилища Commvault](../media/commvault-add-storage.png)

10. Наконец, добавьте новый ресурс службы хранилища Azure в существующий или новый план в центре команд Commvault с помощью команды "Управление" — > "планы" в качестве места назначения резервной копии.

    ![Добавление хранилища Commvault](../media/commvault-plan.png)

11. ***(Необязательно)*** Если вы планируете использовать Azure как сайт восстановления или Commvault для переноса серверов и приложений в Azure, рекомендуется развернуть прокси-сервер VSA в Azure. Подробные инструкции можно найти [здесь](https://documentation.commvault.com/commvault/v11/article?p=106208.htm).  

### <a name="azure-alerting-and-performance-monitoring"></a>Мониторинг оповещений и производительности Azure

Рекомендуется отслеживать как ресурсы Azure, так и возможность Commvault использовать их, как и в случае с любым целевым объектом хранилища, которые вы используете для хранения резервных копий. Сочетание средств мониторинга центра команд Azure Monitor и Commvault поможет обеспечить работоспособность вашей среды.

#### <a name="microsoft-azure-portal"></a>Портал Microsoft Azure

Microsoft Azure предоставляет надежное решение для мониторинга в виде [Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/insights/monitor-azure-resource). Вы можете [настроить Azure Monitor](https://docs.microsoft.com/azure/storage/common/monitor-storage?toc=%2Fazure%2Fstorage%2Fblobs%2Ftoc.json&tabs=azure-powershell#configuration) для мониторинга емкости хранилища Azure, транзакций, доступности, проверки подлинности и многого другого. Полный справочник по трассировке метрик можно найти [здесь](https://docs.microsoft.com/azure/storage/common/monitor-storage-reference). Ниже приведены несколько полезных метрик, которые необходимо отBlobCapacity, чтобы убедиться, что вы следите за максимальным [предельным значением емкости учетной записи хранения](https://docs.microsoft.com/azure/storage/common/scalability-targets-standard-account), входящим и исходящим, чтобы отвести данные, записываемые в учетную запись хранения Azure и считанные из нее, а также SuccessE2ELatency — для учета времени обмена запросами в службу хранилища Azure и из нее, а также в медиаажент. 

Вы также можете [создавать оповещения журнала](https://docs.microsoft.com/azure/service-health/alerts-activity-log-service-notifications) для [мониторинга](https://status.azure.com/status) работоспособности службы хранилища Azure и просматривать ее в любое время.

#### <a name="commvault-command-center"></a>Центр команд Commvault

[Создание оповещений для пулов облачных хранилищ](https://documentation.commvault.com/commvault/v11/article?p=100514_3.htm)

[Где можно перейти к просмотру отчетов о производительности, завершении задания и началу основных неполадок](https://documentation.commvault.com/commvault/v11/article?p=95306_1.htm) 

### <a name="how-to-open-support-cases"></a>Как открыть варианты поддержки

Если вам нужна помощь с резервным копированием в решение Azure, мы рекомендуем открыть обращение с Commvault и Azure, чтобы наши организации поддержки могли сотрудничать в совместной работе, если это необходимо.

#### <a name="how-to-open-a-case-with-commvault"></a>Как открыть обращение с помощью Commvault

Перейдите на [сайт поддержки Commvault](https://www.commvault.com/support), войдите в систему и откройте обращение.

Если вам нужно ознакомиться с доступными возможностями контракта на поддержку, см. раздел [варианты поддержки Commvault](https://ma.commvault.com/support) .

Вы также можете вызвать в, чтобы открыть обращение, или обратиться в службу поддержки Commvault по электронной почте:

Бесплатный звонок: + 1 877-780-3077

[Номера поддержки по всему миру](https://ma.commvault.com/Support/TelephoneSupport)

[Поддержка электронной почты Commvault](mailto:support@commvault.com)

#### <a name="how-to-open-a-case-with-the-azure-support-team"></a>Как открыть обращение в службу поддержки Azure

В [портал Azure](https://portal.azure.com) выполните поиск по фразе "поддержка" в строке поиска в верхней части портала и выберите "+ новый запрос в службу поддержки". 
> [!Note]
При открытии обращения необходимо иметь в качестве вспомогательного средства "Служба хранилища Azure" или "сеть Azure", а **не** "Azure Backup". Azure Backup является Microsoft Azure собственной службой, и ваш случай будет маршрутизироваться неправильно.

### <a name="links-to-relevant-commvault-documentation"></a>Ссылки на соответствующую документацию по Commvault

Документация по Commvault, предоставляющая дополнительные сведения:

[Пользовательское руководством по Commvault](https://documentation.commvault.com/commvault/v11/article?p=37684_1.htm)

[Commvault по архитектуре Azure](https://www.commvault.com/resources/public-cloud-architecture-guide-for-microsoft-azure-v11-sp16) 

### <a name="link-to-marketplace-offering"></a>Ссылка на предложение Marketplace

Вы также можете продолжить использовать известное и надежное решение Commvault для защиты рабочих нагрузок, работающих в Azure. Commvault упростила развертывание своего решения в Azure и защиту виртуальных машин Azure и многих других служб Azure.

[Развертывание Commvault с помощью Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/apps/commvault.commvault?tab=Overview)

[Таблица Azure](https://www.commvault.com/resources/microsoft-azure-cloud-platform-datasheet)

[Полный список поддерживаемых функций и служб Azure](https://documentation.commvault.com/commvault/v11/article?p=109795_1.htm)

[Как использовать Commvault для защиты SAP HANA в Azure](https://azure.microsoft.com/resources/protecting-sap-hana-in-azure/)

## <a name="next-steps"></a>Дальнейшие действия

Изучите дополнительные ресурсы на этих внешних веб-сайтах, чтобы получить сведения о специализированных сценариях использования:

[Использование Commvault для переноса серверов и приложений в Azure](https://www.commvault.com/resources/demonstration-vmware-to-azure-migrations-with-commvault)

[Защита SAP в Azure с помощью Commvault](https://www.youtube.com/watch?v=4ZGGE53mGVI)

[Защита Office 365 с помощью Commvault](https://www.youtube.com/watch?v=dl3nvAacxZU)
