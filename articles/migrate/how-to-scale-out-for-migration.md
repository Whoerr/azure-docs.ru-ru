---
title: Настройка масштабируемого устройства миграции Azure для миграции VMware без агента
description: Узнайте, как настроить масштабированное устройство миграции Azure для миграции виртуальных машин Hyper-V.
author: anvar-ms
ms.author: anvar
ms.manager: bsiva
ms.topic: how-to
ms.date: 03/02/2021
ms.openlocfilehash: fda9026adf46a26927912b9e1983a537470c37ee
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101746576"
---
# <a name="scale-agentless-migration-of-vmware-virtual-machines-to-azure"></a>Масштабирование переноса виртуальных машин VMware в Azure без агента

Эта статья поможет вам понять, как использовать масштабируемое устройство для переноса большого количества виртуальных машин VMware в Azure с помощью средства миграции с миграцией без агента в Azure Migration Server. 

Благодаря миграции виртуальных машин VMware без агента с помощью средства миграции сервера вы можете:

- Репликация до 300 виртуальных машин с одного сервера vCenter одновременно с помощью одного устройства для миграции Azure.
- Одновременное выполнение репликации до 500 виртуальных машин с одного сервера vCenter путем развертывания второго масштабируемого устройства для миграции.

В этой статье раскрываются следующие темы:

- Развертывание масштабируемого устройства для миграции VMware
- Миграция до 500 виртуальных машин одновременно с помощью масштабируемого устройства.

##  <a name="prerequisites"></a>Предварительные требования

Прежде чем приступить к работе, необходимо выполнить следующие действия.

- Создайте проект службы "миграция Azure".
- Разверните устройство "миграция Azure" (основное устройство) и выполните обнаружение виртуальных машин VMware, управляемых сервером vCenter.
- Настройте репликацию для одной или нескольких виртуальных машин, которые будут перенесены.
> [!IMPORTANT]
> Прежде чем можно будет добавить масштабированное устройство для миграции, в проекте должна быть хотя бы одна виртуальная машина.

## <a name="deploy-a-scale-out-appliance"></a>Развертывание масштабируемого устройства


Чтобы добавить масштабируемое устройство, выполните описанные ниже действия.

1. Щелкните **Обнаружение**  >  **Компьютеры виртуализированы?** 
1. Выберите **Да, с помощью гипервизора VMware vSphere.**
1. На следующем шаге выберите репликацию без агента.
1. Выберите **параметр горизонтальное масштабирование существующего основного устройства** в меню выберите тип устройства.
1. Выберите Основное устройство (устройство, с помощью которого было выполнено обнаружение), которое вы хотите масштабировать.

:::image type="content" source="./media/how-to-scale-out-for-migration/add-scale-out.png" alt-text="Страница обнаружения компьютеров для адаптации к масштабному масштабированию":::

### <a name="1-generate-the-azure-migrate-project-key"></a>1. Создание ключа проекта службы "Миграция Azure"

1. В **разделе Создание ключа проекта для службы "миграция Azure**" укажите имя суффикса для масштабируемого устройства. Суффикс может содержать только буквы, цифры и длину, равную 14 символам.
2. Нажмите кнопку **создать ключ** , чтобы начать создание необходимых ресурсов Azure. Не закрывайте страницу обнаружения во время создания ресурсов.
3. Скопируйте созданный ключ. Этот ключ потребуется позже для завершения регистрации масштабируемого устройства.

### <a name="2-download-the-installer-for-the-scale-out-appliance"></a>2. Скачайте установщик для масштабируемого устройства.

На панели **скачивание устройства для миграции Azure** нажмите кнопку  **скачать**. Необходимо скачать сценарий установщика PowerShell для развертывания масштабируемого устройства на существующем сервере под управлением Windows Server 2016 и с требуемой конфигурацией оборудования (32 ГБ ОЗУ, 8 виртуальных ЦП, около 80 ГБ дискового пространства и доступ к Интернету напрямую или через прокси-сервер).
:::image type="content" source="./media/how-to-scale-out-for-migration/download-scale-out.png" alt-text="Скачать скрипт для масштабируемого устройства":::

> [!TIP]
> Вы можете проверить контрольную сумму скачанного ZIP-файла, выполнив следующие действия.
>
> 1. Открыть командную строку от имени администратора
> 2. Выполните следующую команду, чтобы создать хэш ZIP-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример использования для общедоступного облака: ```C:\>CertUtil -HashFile C:\Users\administrator\Desktop\AzureMigrateInstaller.zip SHA256 ```.
> 3. Скачайте последнюю версию установщика масштабируемых устройств с портала, если вычисленное значение хэша не соответствует этой строке: e9c9a1fe4f3ebae81008328e8f3a7933d78ff835ecd871d1b17f367621ce3c74

### <a name="3-run-the-azure-migrate-installer-script"></a>3. Запуск скрипта установщика службы "Миграция Azure"
Скрипт установщика выполняет следующие операции.

- Устанавливает агент шлюза и Диспетчер конфигурации устройств для выполнения более параллельных репликаций серверов.
- Устанавливает роли Windows, включая службу активации Windows, IIS и интегрированную среду разработку PowerShell.
- Скачивает и устанавливает доступный для записи модуль IIS. [Подробнее](https://www.microsoft.com/download/details.aspx?id=7435).
- Обновляет раздел реестра (HKLM), используя постоянные значения параметров для службы "Миграция Azure".
- Создает следующие файлы по указанному пути.
    - **Файлы конфигурации**: %Programdata%\Microsoft Azure\Config
    - **Файлы журнала**: %Programdata%\Microsoft Azure\Logs

Выполните скрипт следующим образом:

1. Извлеките ZIP-файл в папку на сервере, где будет размещаться масштабируемое устройство.  Убедитесь, что сценарий не выполняется на сервере с существующим устройством миграции Azure.
2. Запустите PowerShell на указанном сервере с повышенными правами (права администратора).
3. Измените каталог PowerShell на папку, в которую было извлечено содержимое из скачанного ZIP-файла.
4. Запустите скрипт с именем **AzureMigrateInstaller.ps1**  с помощью следующей команды:

    - Для общедоступного облака: 
    
        ``` PS C:\Users\administrator\Desktop\AzureMigrateInstaller-Server-Public> .\AzureMigrateInstaller.ps1 ```

    Скрипт запустит Диспетчер конфигурации устройства при завершении выполнения.

При возникновении любых проблем вы можете получить доступ к журналам сценариев: <br/> Файла c:\ProgramData\Microsoft Азуре\логс\ AzureMigrateScenarioInstaller_<em>метку времени</em>. log для устранения неполадок.


### <a name="4-configure-the-appliance"></a>4. Настройка устройства

Перед началом убедитесь, что [эти конечные точки Azure](migrate-appliance.md#public-cloud-urls) доступны из масштабируемого устройства.

- Откройте браузер на любом компьютере, который может подключаться к серверу масштабируемых устройств, и откройте URL-адрес диспетчера конфигурации устройства: **https://*(имя или IP-адрес устройства масштабирования)*: 44368**.

   Кроме того, диспетчер конфигурации можно открыть на рабочем столе сервера масштабируемых устройств с помощью ярлыка диспетчера конфигурации.
- Примите **условия лицензии** и прочитайте информацию от сторонних производителей.
- В Configuration Manager > **настроить необходимые компоненты**, выполните следующие действия.
   - **Подключение**. устройство проверяет, есть ли у сервера доступ к Интернету. Если на сервере используется прокси-сервер:
     1. Щелкните **Настройка прокси-сервера**, чтобы указать адрес прокси-сервера (в формате http://ProxyIPAddress или http://ProxyFQDN) ) и порт прослушивания.
     2. Укажите учетные данные, если для прокси-сервера требуется аутентификация.
     3. Поддерживается только прокси-сервер HTTP.
     4. Если вы добавили сведения о прокси-сервере или отключили его и (или) проверку подлинности, щелкните **Сохранить**, чтобы снова запустить проверку подключения.
   - **Синхронизация времени**: Время на устройстве должно быть синхронизировано со временем в Интернете, чтобы обнаружение виртуальных машин работало правильно.
   - **Установка обновлений**: Устройство обеспечивает установку последних обновлений. После завершения проверки можно щелкнуть **Просмотр служб устройства** , чтобы просмотреть состояние и версии служб, работающих на сервере устройства.
   - **Установка VDDK**. Устройство проверяет, установлен ли пакет VMware vSphere Virtual Disk Development Kit (VDDK). Если он не установлен, скачайте ВДДК 6,7 из VMware и извлеките содержимое скачанного ZIP-файла в указанное расположение на устройстве, как указано в **инструкциях по установке** на экране устройства Configuration Manager.


### <a name="register-the-appliance-with-azure-migrate"></a>Регистрация устройства с помощью службы "Миграция Azure"

1. Вставьте **ключ проекта службы "Миграция Azure"** , скопированный с портала. Если у вас нет ключа, перейдите в раздел **Оценка сервера> обнаружение> управление существующими устройствами**, выберите имя основного устройства, найдите связанное с ним масштабируемое устройство и скопируйте соответствующий ключ.
1. Вам потребуется код устройства для аутентификации в Azure. Если щелкнуть **Вход**, откроется модальное окно с кодом устройства, как показано ниже.
:::image type="content" source="./media/tutorial-discover-vmware/device-code.png" alt-text="Модальное окно с кодом устройства":::

1. Щелкните **Копировать код и войти**, чтобы скопировать код устройства и открыть окно входа в Azure в новой вкладке браузера. Если этот параметр не отображается, убедитесь, что в браузере отключена блокировка всплывающих окон.
1. В новой вкладке вставьте код устройства выполните вход, используя имя пользователя и пароль Azure.
   
   Вход с помощью PIN-кода не поддерживается.
3. Если вы случайно закроете вкладку входа, не выполнив вход, вам потребуется обновить вкладку браузера в диспетчере конфигурации устройства, чтобы снова активировать кнопку "Вход".
1. После успешного входа вернитесь на предыдущую вкладку с помощью диспетчера конфигурации устройства.
1. Если учетная запись пользователя Azure, используемая для ведения журнала, имеет необходимые разрешения на ресурсы Azure, созданные во время создания ключа, будет инициирована регистрация модуля.
:::image type="content" source="./media/how-to-scale-out-for-migration/registration-scale-out.png" alt-text="Панель 2 в диспетчере конфигурации устройства":::

#### <a name="import-appliance-configuration-from-primary-appliance"></a>Импорт конфигурации устройства из основного устройства

Чтобы завершить регистрацию масштабируемого устройства, нажмите кнопку **Импорт** , чтобы получить необходимые файлы конфигурации из основного устройства.

1. При нажатии кнопки **Импорт** открывается всплывающее окно с инструкциями по импорту необходимых файлов конфигурации с основного устройства.
:::image type="content" source="./media/how-to-scale-out-for-migration/import-modal-scale-out.png" alt-text="Модальная конфигурация импорта":::
1. Войдите в основное устройство (удаленный рабочий стол) и выполните следующие команды PowerShell:

    ``` PS cd 'C:\Program Files\Microsoft Azure Appliance Configuration Manager\Scripts\PowerShell' ```
    
    ``` PS .\ExportConfigFiles.ps1 ```

1. Скопируйте ZIP-файл, созданный, выполнив приведенные выше команды на масштабируемое устройство. ZIP-файл содержит файлы конфигурации, необходимые для регистрации масштабируемого устройства.
1. Во всплывающем окне, открытом на предыдущем шаге, выберите расположение скопированного ZIP-файла конфигурации и нажмите кнопку **сохранить**.

После успешного импорта файлов регистрация масштабируемого устройства завершится, и отобразится метка времени последнего успешного импорта. Вы также можете просмотреть сведения о регистрации, щелкнув **Просмотреть сведения**.
:::image type="content" source="./media/how-to-scale-out-for-migration/import-success.png" alt-text="Импорт выполнен успешно":::

На этом этапе следует повторно проверить, что масштабируемое устройство может подключиться к серверу vCenter. Нажмите кнопку Повторная **Проверка** , чтобы проверить vCenter Server подключение из масштабируемого устройства.
:::image type="content" source="./media/how-to-scale-out-for-migration/view-sources.png" alt-text="Импорт выполнен успешно":::

> [!IMPORTANT]
> При изменении учетных данных vCenter Server на основном устройстве убедитесь, что вы повторно импортируете файлы конфигурации на масштабируемое устройство, чтобы получить последнюю конфигурацию и продолжить все текущие репликации.<br/> Если масштабируемое устройство больше не требуется, убедитесь, что вы отключили масштабируемое устройство. Дополнительные [**сведения**](./common-questions-appliance) об отключении масштабируемого устройства, когда это не требуется.

## <a name="replicate"></a>Репликация

1. После регистрации устройства масштабирования на плитке миграция Azure: миграция сервера нажмите кнопку **реплицировать**.

2.  Следуйте инструкциям на экране, чтобы начать репликацию дополнительных виртуальных машин. 

Теперь с масштабируемым устройством можно реплицировать 500 виртуальных машин одновременно. Кроме того, виртуальные машины можно перенести пакетами по 200 с помощью портал Azure.

Средство миграции сервера Azure выполняет миграцию виртуальных машин между основным и масштабируемым устройством для репликации. После завершения репликации можно выполнить миграцию виртуальных машин.

> [!TIP]
> Рекомендуется переносить виртуальные машины пакетами 200, чтобы обеспечить оптимальную производительность, если требуется перенести большое количество виртуальных машин.
  
## <a name="next-steps"></a>Дальнейшие действия

Из этой статьи вы узнали следующее:
- Настройка масштабируемого устройства
- Репликация виртуальных машин с помощью масштабируемого устройства


[Дополнительные сведения](https://docs.microsoft.com/azure/migrate/tutorial-migrate-vmware) о переносе серверов в Azure с помощью средства миграции Azure см. в статье Миграция сервера.