---
title: Автоматическая установка исправлений гостевых виртуальных машин для виртуальных машин Azure
description: Узнайте, как автоматически исправлять виртуальные машины в Azure.
author: mayanknayar
ms.service: virtual-machines
ms.subservice: automatic-guest-patching
ms.collection: windows
ms.workload: infrastructure
ms.topic: how-to
ms.date: 02/17/2021
ms.author: manayar
ms.openlocfilehash: 276762bc2b8624f687cbb77e1af771478791a57b
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2021
ms.locfileid: "101680317"
---
# <a name="preview-automatic-vm-guest-patching-for-azure-vms"></a>Предварительная версия: автоматическая установка исправлений гостевых виртуальных машин для виртуальных машин Azure

Включение автоматической установки исправлений гостевых ВИРТУАЛЬНЫХ машин для виртуальных машин Azure помогает упростить управление обновлениями с помощью безопасного и автоматического исправления виртуальных машин для обеспечения соответствия безопасности.

Автоматическая установка исправлений гостевых виртуальных машин имеет следующие характеристики.
- Исправления, классифицированные как *критические* , или *Безопасность* , автоматически загружаются и применяются к виртуальной машине.
- Исправления применяются в часы наименьшей нагрузки в часовом поясе виртуальной машины.
- Управление исправлениями осуществляется с помощью Azure, а исправления применяются после [принципов доступности](#availability-first-patching).
- Отслеживание работоспособности виртуальной машины, которое определяется с помощью сигналов работоспособности платформы, отслеживается для обнаружения сбоев исправления.
- Работает со всеми размерами виртуальных машин.

> [!IMPORTANT]
> Автоматическая установка исправлений гостевых виртуальных машин в настоящее время доступна в общедоступной предварительной версии. Для использования функции общедоступной предварительной версии, описанной ниже, требуется процедура согласия.
> Предварительная версия предоставляется без соглашения об уровне обслуживания. Мы не рекомендуем использовать ее в рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены.
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="how-does-automatic-vm-guest-patching-work"></a>Как работает автоматическая установка исправлений гостевых виртуальных машин?

Если на виртуальной машине включено автоматическое обновление гостевых виртуальных машин, то доступные *критически важные* обновления и исправления *безопасности* будут скачаны и применены на виртуальной машине автоматически. Этот процесс начинается автоматически каждый месяц при выпуске новых исправлений. Оценка и установка исправлений выполняются автоматически, и процесс включает перезагрузку виртуальной машины по мере необходимости.

Виртуальная машина оценивается периодически каждые несколько дней и несколько раз в течение любого 30-дневного периода, чтобы определить применимые исправления для этой виртуальной машины. Исправления можно установить в любой день на ВИРТУАЛЬНОЙ машине в часы наименьшей нагрузки для виртуальной машины. Эта автоматическая оценка гарантирует, что все отсутствующие исправления будут обнаружены по самой ранней возможной возможности.

Исправления устанавливаются в течение 30 дней после ежемесячных выпусков исправлений, как описано ниже, с помощью согласования доступности. Исправления устанавливаются только в часы наименьшей нагрузки для виртуальной машины в зависимости от часового пояса виртуальной машины. Для автоматической установки исправлений виртуальная машина должна быть запущена в часы наименьшей нагрузки. Если во время периодической оценки виртуальная машина отключена, она будет автоматически оцениваться, а применимые исправления будут автоматически устанавливаться во время следующей периодической оценки (обычно в течение нескольких дней) при включении виртуальной машины.

Обновления определений и другие исправления, не классифицированные как *критические* , или *Безопасность* не будут устанавливаться с помощью автоматического исправления гостевых виртуальных машин. Чтобы установить исправления с другими классификациями исправлений или запланировать установку исправлений в рамках собственного настраиваемого периода обслуживания, можно использовать [Управление обновлениями](./windows/tutorial-config-management.md#manage-windows-updates).

### <a name="availability-first-patching"></a>Доступность — сначала установка исправлений

Процесс установки исправлений управляется глобально Azure для всех виртуальных машин, на которых включено автоматическое исправление гостевой виртуальной машины. Это согласование соответствует принципам доступности — первыми на разных уровнях доступности, предоставляемых Azure.

Для группы виртуальных машин, которые подчиняются обновлению, Платформа Azure будет управлять обновлениями:

**Между регионами:**
- Ежемесячное обновление управляется в Azure глобально за один этап, чтобы предотвратить сбои глобальных развертываний.
- На фазе может быть один или несколько регионов, а обновление переходит к следующим этапам только в случае успешного обновления соответствующих виртуальных машин в фазе.
- Геопарные регионы не обновляются одновременно и не могут находиться на одном региональном этапе.
- Успешность обновления измеряется путем отслеживания обновления работоспособности виртуальной машины. Работоспособность виртуальной машины отбирается с помощью индикаторов работоспособности платформы для виртуальной машины.

**В пределах региона:**
- Виртуальные машины в разных Зоны доступности не обновляются одновременно.
- Виртуальные машины, не входящие в группу доступности, объединяются в пакетном режиме, чтобы избежать параллельных обновлений для всех виртуальных машин в подписке.

**В группе доступности:**
- Все виртуальные машины в общей группе доступности не обновляются одновременно.
-   Виртуальные машины в общей группе доступности обновляются в границах домена обновления, а виртуальные машины в нескольких доменах обновления не обновляются одновременно.

Дата установки исправления для данной виртуальной машины может варьироваться в месяц, так как конкретная виртуальная машина может быть выбрана в другом пакете между ежемесячными циклами обновления.

### <a name="which-patches-are-installed"></a>Какие исправления установлены?
Установленные исправления зависят от этапа развертывания виртуальной машины. Каждый месяц запускается новое глобальное развертывание, где для этой ВИРТУАЛЬНОЙ машины устанавливаются все исправления безопасности и критические обновления, которые оцениваются для отдельной виртуальной машины. Развертывание управляется всеми регионами Azure в пакетах (см. раздел о доступности, впервые описанном выше).

Точный набор устанавливаемых исправлений зависит от конфигурации виртуальной машины, включая тип ОС и время оценки. Для двух идентичных виртуальных машин в разных регионах можно установить разные исправления, если имеется больше или меньше исправлений, доступных при достижении разных регионов в разных регионах. Аналогично, но менее часто виртуальные машины в одном регионе, но оцениваются в разное время (из-за различных пакетов зоны доступности или группы доступности) могут получить разные исправления.

Поскольку автоматическая установка исправлений гостевых виртуальных машин не настраивает источник обновления, две аналогичные виртуальные машины, настроенные для различных источников исправлений, таких как общедоступный репозиторий и частный репозиторий, могут также заметить разницу в конкретном наборе установленных исправлений.

Для типов ОС, которые выпускают исправления на фиксированной частоте, виртуальные машины, настроенные на общедоступный репозиторий для операционной системы, могут получить один и тот же набор исправлений на разных этапах развертывания в течение месяца. Например, виртуальные машины Windows, настроенные на общедоступный репозиторий Центр обновления Windows.

Как только новый выпуск запускается каждый месяц, виртуальная машина будет получать по крайней мере один выпуск исправлений каждый месяц, если виртуальная машина включена в часы наименьшей нагрузки. Это гарантирует, что виртуальная машина будет обновлена с самыми последними доступными исправлениями безопасности и критическими обновлениями на ежемесячной основе. Чтобы обеспечить согласованность в установленном наборе исправлений, можно настроить виртуальные машины для оценки и загрузки исправлений из собственных частных репозиториев.

## <a name="supported-os-images"></a>Поддерживаемые образы ОС
В предварительной версии поддерживаются только виртуальные машины, созданные на основе определенных образов платформы ОС. В настоящее время предварительная версия не поддерживает пользовательские образы.

В настоящее время поддерживаются следующие SKU платформы (и периодически добавляются дополнительные):

| Publisher               | Предложение ОС      |  Sku               |
|-------------------------|---------------|--------------------|
| Canonical  | UbuntuServer | 18.04-LTS |
| Redhat  | RHEL | 7.x |
| MicrosoftWindowsServer  | WindowsServer | 2012-R2-Datacenter |
| MicrosoftWindowsServer  | WindowsServer | 2016-Datacenter    |
| MicrosoftWindowsServer  | WindowsServer | 2016-Datacenter-Server-Core |
| MicrosoftWindowsServer  | WindowsServer | 2019-Datacenter |
| MicrosoftWindowsServer  | WindowsServer | 2019-Datacenter-Core |

## <a name="patch-orchestration-modes"></a>Режимы оркестрации исправлений
Виртуальные машины в Azure теперь поддерживают следующие режимы оркестрации исправлений:

**Аутоматикбиплатформ:**
- Этот режим поддерживается для виртуальных машин Linux и Windows.
- Этот режим включает автоматическую установку исправлений гостевых виртуальных машин для виртуальной машины, а последующие установки исправлений управляются Azure.
- Этот режим необходим для установки исправлений, необходимых для обеспечения доступности.
- Этот режим поддерживается только для виртуальных машин, созданных с помощью описанных выше образов платформы операционной системы.
- Для виртуальных машин Windows Установка этого режима также отключает собственный автоматическое обновление на виртуальной машине Windows во избежание дублирования.
- Чтобы использовать этот режим на виртуальных машинах Linux, задайте свойство `osProfile.linuxConfiguration.patchSettings.patchMode=AutomaticByPlatform` в шаблоне виртуальной машины.
- Чтобы использовать этот режим на виртуальных машинах Windows, задайте свойство `osProfile.windowsConfiguration.enableAutomaticUpdates=true` и задайте свойство  `osProfile.windowsConfiguration.patchSettings.patchMode=AutomaticByPlatform` в ШАБЛОНЕ виртуальной машины.

**Аутоматикбйос:**
- Этот режим поддерживается только для виртуальных машин Windows.
- Этот режим включает автоматическое обновление на виртуальной машине Windows, а исправления устанавливаются на ВИРТУАЛЬНОЙ машине с помощью автоматическое обновление.
- Этот режим не поддерживает обновление при первом доступе.
- Этот режим задается по умолчанию, если для виртуальной машины Windows не указан другой режим обновления.
- Чтобы использовать этот режим на виртуальных машинах Windows, задайте свойство `osProfile.windowsConfiguration.enableAutomaticUpdates=true` и задайте свойство  `osProfile.windowsConfiguration.patchSettings.patchMode=AutomaticByOS` в ШАБЛОНЕ виртуальной машины.

**Вручную:**
- Этот режим поддерживается только для виртуальных машин Windows.
- Этот режим отключает автоматическое обновление на виртуальной машине Windows.
- Этот режим не поддерживает обновление при первом доступе.
- Этот режим следует задавать при использовании настраиваемых решений по исправлению.
- Чтобы использовать этот режим на виртуальных машинах Windows, задайте свойство `osProfile.windowsConfiguration.enableAutomaticUpdates=false` и задайте свойство  `osProfile.windowsConfiguration.patchSettings.patchMode=Manual` в ШАБЛОНЕ виртуальной машины.

**Имажедефаулт:**
- Этот режим поддерживается только для виртуальных машин Linux.
- Этот режим не поддерживает обновление при первом доступе.
- Этот режим учитывает конфигурацию исправлений по умолчанию в образе, который используется для создания виртуальной машины.
- Этот режим задается по умолчанию, если для виртуальной машины Linux не указан другой режим обновления.
- Чтобы использовать этот режим на виртуальных машинах Linux, задайте свойство `osProfile.linuxConfiguration.patchSettings.patchMode=ImageDefault` в шаблоне виртуальной машины.

> [!NOTE]
>Для виртуальных машин Windows это свойство `osProfile.windowsConfiguration.enableAutomaticUpdates` можно установить в настоящее время только при создании виртуальной машины. Переключение с ручного на автоматический режим или из любого из автоматических режимов в ручной режим сейчас не поддерживается. Переключение из режима Аутоматикбйос в режим Аутоматикбиплатфом поддерживается.

## <a name="requirements-for-enabling-automatic-vm-guest-patching"></a>Требования к включению автоматической установки исправлений для гостевых виртуальных машин

- На виртуальной машине должен быть установлен агент виртуальной машины Azure для [Windows](./extensions/agent-windows.md) или [Linux](./extensions/agent-linux.md) .
- Для виртуальных машин Linux агент Linux для Azure должен иметь версию 2.2.53.1 или более позднюю. [Обновите агент Linux,](./extensions/update-linux-agent.md) если текущая версия ниже требуемой версии.
- Для виртуальных машин Windows на виртуальной машине должна быть запущена служба Центр обновления Windows.
- Виртуальная машина должна иметь доступ к настроенным конечным точкам обновления. Если ваша виртуальная машина настроена для использования частных репозиториев для Linux или Windows Server Update Services (WSUS) для виртуальных машин Windows, то соответствующие конечные точки обновления должны быть доступны.
- Используйте API вычислений версии 2020-12-01 или более поздней. API вычислений версии 2020-06-01 можно использовать для виртуальных машин Windows с ограниченными возможностями.

Включение функции предварительного просмотра требует одноразового согласия на функции **ингуестаутопатчвмпревиев** и **ингуестпатчвмпревиев** на подписку, как описано в следующем разделе.

### <a name="rest-api"></a>REST API
В следующем примере показано, как включить предварительную версию для подписки.

```
POST on `/subscriptions/{subscriptionId}/providers/Microsoft.Features/providers/Microsoft.Compute/features/InGuestAutoPatchVMPreview/register?api-version=2015-12-01`
```
```
POST on `/subscriptions/{subscriptionId}/providers/Microsoft.Features/providers/Microsoft.Compute/features/InGuestPatchVMPreview/register?api-version=2015-12-01`
```

Регистрация компонентов может занять до 15 минут. Чтобы проверить состояние регистрации, сделайте следующее:

```
GET on `/subscriptions/{subscriptionId}/providers/Microsoft.Features/providers/Microsoft.Compute/features/InGuestAutoPatchVMPreview?api-version=2015-12-01`
```
```
GET on `/subscriptions/{subscriptionId}/providers/Microsoft.Features/providers/Microsoft.Compute/features/InGuestPatchVMPreview?api-version=2015-12-01`
```
После регистрации функции для подписки завершите процесс согласия, добавив изменения в поставщик ресурсов вычислений.

```
POST on `/subscriptions/{subscriptionId}/providers/Microsoft.Compute/register?api-version=2020-06-01`
```

### <a name="azure-powershell"></a>Azure PowerShell
Используйте командлет [Register-азпровидерфеатуре](/powershell/module/az.resources/register-azproviderfeature) , чтобы включить предварительную версию для подписки.

```azurepowershell-interactive
Register-AzProviderFeature -FeatureName InGuestAutoPatchVMPreview -ProviderNamespace Microsoft.Compute
Register-AzProviderFeature -FeatureName InGuestPatchVMPreview -ProviderNamespace Microsoft.Compute
```

Регистрация компонентов может занять до 15 минут. Чтобы проверить состояние регистрации, сделайте следующее:

```azurepowershell-interactive
Get-AzProviderFeature -FeatureName InGuestAutoPatchVMPreview -ProviderNamespace Microsoft.Compute
Get-AzProviderFeature -FeatureName InGuestPatchVMPreview -ProviderNamespace Microsoft.Compute
```

После регистрации функции для подписки завершите процесс согласия, добавив изменения в поставщик ресурсов вычислений.

```azurepowershell-interactive
Register-AzResourceProvider -ProviderNamespace Microsoft.Compute
```

### <a name="azure-cli-20"></a>Azure CLI 2.0
Чтобы включить предварительную версию подписки, используйте команду [AZ Feature Register](/cli/azure/feature#az-feature-register) .

```azurecli-interactive
az feature register --namespace Microsoft.Compute --name InGuestAutoPatchVMPreview `
az feature register --namespace Microsoft.Compute --name InGuestPatchVMPreview
```

Регистрация компонентов может занять до 15 минут. Чтобы проверить состояние регистрации, сделайте следующее:

```azurecli-interactive
az feature show --namespace Microsoft.Compute --name InGuestAutoPatchVMPreview `
az feature show --namespace Microsoft.Compute --name InGuestPatchVMPreview
```

После регистрации функции для подписки завершите процесс согласия, добавив изменения в поставщик ресурсов вычислений.

```azurecli-interactive
az provider register --namespace Microsoft.Compute
```

## <a name="enable-automatic-vm-guest-patching"></a>Включение автоматизации исправлений гостевой системы виртуальной машины
Чтобы включить автоматическую установку исправлений гостевых виртуальных машин на виртуальной машине Windows, убедитесь, что для свойства *osProfile. виндовсконфигуратион. енаблеаутоматикупдатес* задано значение *true* в определении шаблона виртуальной машины. Это свойство можно задать только при создании виртуальной машины. Это дополнительное свойство неприменимо для виртуальных машин Linux.

### <a name="rest-api-for-linux-vms"></a>REST API для виртуальных машин Linux
В следующем примере показано, как включить автоматическое исправление гостевой виртуальной машины.

```
PUT on `/subscriptions/subscription_id/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVirtualMachine?api-version=2020-12-01`
```

```json
{
  "properties": {
    "osProfile": {
      "linuxConfiguration": {
        "provisionVMAgent": true,
        "patchSettings": {
          "patchMode": "AutomaticByPlatform"
        }
      }
    }
  }
}
```

### <a name="rest-api-for-windows-vms"></a>REST API для виртуальных машин Windows
В следующем примере показано, как включить автоматическое исправление гостевой виртуальной машины.

```
PUT on `/subscriptions/subscription_id/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVirtualMachine?api-version=2020-06-01`
```

```json
{
  "properties": {
    "osProfile": {
      "windowsConfiguration": {
        "provisionVMAgent": true,
        "enableAutomaticUpdates": true,
        "patchSettings": {
          "patchMode": "AutomaticByPlatform"
        }
      }
    }
  }
}
```

### <a name="azure-powershell-for-windows-vms"></a>Azure PowerShell для виртуальных машин Windows
Используйте командлет [Set-азвмоператингсистем](/powershell/module/az.compute/set-azvmoperatingsystem) , чтобы включить автоматическое исправление ГОСТЕВЫХ виртуальных машин при создании или обновлении виртуальной машины.

```azurepowershell-interactive
Set-AzVMOperatingSystem -VM $VirtualMachine -Windows -ComputerName $ComputerName -Credential $Credential -ProvisionVMAgent -EnableAutoUpdate -PatchMode "AutomaticByPlatform"
```

### <a name="azure-cli-for-windows-vms"></a>Azure CLI для виртуальных машин Windows
Используйте команду [AZ VM Create](/cli/azure/vm#az-vm-create) , чтобы включить автоматическое исправление ГОСТЕВЫХ виртуальных машин при создании новой виртуальной машины. В следующем примере выполняется настройка автоматической установки исправлений гостевых виртуальных машин для виртуальной машины с именем *myVM* в группе ресурсов с именем *myResourceGroup*:

```azurecli-interactive
az vm create --resource-group myResourceGroup --name myVM --image Win2019Datacenter --enable-agent --enable-auto-update --patch-mode AutomaticByPlatform
```

Чтобы изменить существующую виртуальную машину, используйте команду [AZ VM Update](/cli/azure/vm#az-vm-update) .

```azurecli-interactive
az vm update --resource-group myResourceGroup --name myVM --set osProfile.windowsConfiguration.enableAutomaticUpdates=true osProfile.windowsConfiguration.patchSettings.patchMode=AutomaticByPlatform
```

## <a name="enablement-and-assessment"></a>Включение и оценка

> [!NOTE]
>Включение автоматического обновления гостевых виртуальных машин на виртуальной машине может занять более трех часов, так как включение завершается в часы низкой нагрузки на виртуальную машину. Так как установка оценки и исправлений выполняется только в часы наименьшей нагрузки, для применения исправлений виртуальная машина должна быть также запущена в часы наименьшей нагрузки.

Если для виртуальной машины включено автоматическое обновление гостевых виртуальных машин, то на виртуальной машине Linux устанавливается расширение виртуальной машины типа или на виртуальной машине `Microsoft.CPlat.Core.LinuxPatchExtension` Windows устанавливается расширение типа виртуальной машины `Microsoft.CPlat.Core.WindowsPatchExtension` . Это расширение не требуется устанавливать или обновлять вручную, так как это расширение управляется платформой Azure в рамках автоматического процесса обновления гостевых виртуальных машин.

Включение автоматического обновления гостевых виртуальных машин на виртуальной машине может занять более трех часов, так как включение завершается в часы низкой нагрузки на виртуальную машину. Расширение также устанавливается и обновляется в часы наименьшей нагрузки для виртуальной машины. В случае завершения работы в нерабочее время в течение непикового периода перед включением можно будет продолжить процесс включения в течение следующего доступного времени.

В большинстве сценариев автоматическое обновление отключено, и установка исправлений выполняется с помощью расширения. Применяются следующие условия.
- Если на виртуальной машине Windows ранее была включена автоматическая Центр обновления Windows в режиме исправления Аутоматикбйос, то при установке расширения автоматически Центр обновления Windows для виртуальной машины отключена.
- Для виртуальных машин Ubuntu автоматическое обновление по умолчанию автоматически отключается, когда автоматическое исправление гостевой виртуальной машины завершается.
- Для RHEL автоматическое обновление необходимо отключить вручную (это ограничение предварительной версии). Выполните:

```
systemctl stop packagekit
```

```
systemctl mask packagekit
```

Чтобы убедиться, что автоматическое исправление гостевой виртуальной машины завершено и на виртуальной машине установлено расширение исправлений, можно просмотреть представление экземпляров виртуальной машины. Если процесс включения завершен, то расширение будет установлено, а результаты оценки для виртуальной машины будут доступны в разделе `patchStatus` . Доступ к представлению экземпляра виртуальной машины можно получить несколькими способами, как описано ниже.

### <a name="rest-api"></a>REST API

```
GET on `/subscriptions/subscription_id/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVirtualMachine/instanceView?api-version=2020-12-01`
```
### <a name="azure-powershell"></a>Azure PowerShell
Используйте командлет [Get-AzVM](/powershell/module/az.compute/get-azvm) с `-Status` параметром, чтобы получить доступ к представлению экземпляра для виртуальной машины.

```azurepowershell-interactive
Get-AzVM -ResourceGroupName "myResourceGroup" -Name "myVM" -Status
```

В настоящее время PowerShell предоставляет сведения только о расширении исправления. `patchStatus`Кроме того, сведения о скоро будут доступны в PowerShell.

### <a name="azure-cli"></a>Azure CLI
Чтобы получить доступ к представлению экземпляра для виртуальной машины, используйте команду [AZ VM Get-instance-View](/cli/azure/vm#az-vm-get-instance-view) .

```azurecli-interactive
az vm get-instance-view --resource-group myResourceGroup --name myVM
```

### <a name="understanding-the-patch-status-for-your-vm"></a>Основные сведения о состоянии исправления для виртуальной машины

В `patchStatus` разделе ответ представления экземпляров содержатся сведения о последней оценке и установке последнего исправления для виртуальной машины.

Результаты оценки для виртуальной машины можно просмотреть в `availablePatchSummary` разделе. Оценка периодически выполняется для виртуальной машины, для которой включена автоматическая установка исправлений гостевых виртуальных машин. Число доступных исправлений после того, как оценка будет предоставлена в `criticalAndSecurityPatchCount` и `otherPatchCount` результатах. При автоматической установке исправлений гостевых виртуальных машин будут установлены все исправления, оцененные в соответствии с классификацией *критических* обновлений и исправлений *безопасности* . Любое другое исправление с оценкой пропускается.

Результаты установки исправления для виртуальной машины можно просмотреть в `lastPatchInstallationSummary` разделе. В этом разделе приводятся сведения о последней попытке установки исправления на виртуальной машине, включая количество установленных, ожидающих, неудачных или пропущенных исправлений. Исправления устанавливаются только в течение периода обслуживания виртуальных машин в нерабочее время. Ожидающие и неудачные исправления автоматически повторяются в течение следующего периода обслуживания в течение непиковой нагрузки.

## <a name="on-demand-patch-assessment"></a>Оценка исправлений по запросу
Если автоматическая установка исправлений гостевых виртуальных машин уже включена для виртуальной машины, на ВИРТУАЛЬНОЙ машине выполняется периодическая оценка исправления в течение непиковых часов виртуальной машины. Этот процесс выполняется автоматически, и результаты последней оценки можно просмотреть в представлении экземпляра виртуальной машины, как описано выше в этом документе. Вы также можете запустить оценку исправления по запросу для виртуальной машины в любое время. Оценка исправления может занять несколько минут, и состояние последней оценки обновляется в представлении экземпляров виртуальной машины.

Для включения функции предварительной версии требуется одноразовый явный выбор функции **ингуестпатчвмпревиев** на подписку. Эта предварительная версия компонента отличается от автоматической регистрации функции исправления гостевых виртуальных машин, выполненной ранее для **ингуестаутопатчвмпревиев**. Включение дополнительного компонента Предварительная версия является отдельным и дополнительным требованием. Предварительную версию функции оценки исправлений по запросу можно включить после [процесса включения предварительной версии](automatic-vm-guest-patching.md#requirements-for-enabling-automatic-vm-guest-patching) , описанного ранее для автоматического исправления ГОСТЕВЫХ виртуальных машин.

> [!NOTE]
>Оценка исправлений по запросу не запускает автоматическую установку исправлений автоматически. Если вы включили автоматическое обновление гостевых виртуальных машин, то оценки и применимые исправления для виртуальной машины будут установлены во время низкой нагрузки на виртуальную машину, следуя процессу исправления, описанному выше в этом документе.

### <a name="rest-api"></a>REST API
```
POST on `/subscriptions/subscription_id/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVirtualMachine/assessPatches?api-version=2020-12-01`
```

### <a name="azure-powershell"></a>Azure PowerShell
Используйте командлет [Invoke-азвмпатчассессмент](/powershell/module/az.compute/invoke-azvmpatchassessment) для оценки доступных исправлений для виртуальной машины.

```azurepowershell-interactive
Invoke-AzVmPatchAssessment -ResourceGroupName "myResourceGroup" -VMName "myVM"
```

### <a name="azure-cli"></a>Azure CLI
Используйте команду [AZ VM оценкой-патчи](/cli/azure/vm#az-vm-assess-patches) для оценки доступных исправлений для виртуальной машины.

```azurecli-interactive
az vm assess-patches --resource-group myResourceGroup --name myVM
```

## <a name="next-steps"></a>Дальнейшие действия
> [!div class="nextstepaction"]
> [Дополнительные сведения о создании виртуальных машин Windows и управлении ими](./windows/tutorial-manage-vm.md)
