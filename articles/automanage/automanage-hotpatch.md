---
title: Хотпатч для выпуска Windows Server Azure (Предварительная версия)
description: Узнайте, как работает Хотпатч для выпуска Windows Server Azure и как его включить.
author: ju-shim
ms.service: virtual-machines
ms.subservice: automanage
ms.workload: infrastructure
ms.topic: conceptual
ms.date: 02/22/2021
ms.author: jushiman
ms.openlocfilehash: 710e6902be6ebe28caaf40fb446e4ee7cd2bf4dc
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101687572"
---
# <a name="hotpatch-for-new-virtual-machines-preview"></a>Хотпатч для новых виртуальных машин (Предварительная версия)

Функция HotPatching — это новый способ установки обновлений на новых виртуальных машинах Windows Server Azure Edition, которые не нуждаются в перезагрузке после установки. В этой статье рассматриваются сведения о Хотпатч для виртуальных машин Windows Server Azure Edition, которые имеют следующие преимущества:
* Снижение влияния рабочей нагрузки на меньшее количество перезагрузок
* Более быстрое развертывание обновлений по мере того, как пакеты меньше, устанавливаются быстрее и упрощают внедрение исправлений с помощью диспетчера обновления Azure.
* Улучшенная защита, так как пакеты обновления Хотпатч ограничены обновлениями безопасности Windows, которые устанавливаются быстрее без перезагрузки

## <a name="how-hotpatch-works"></a>Как работает хотпатч

Хотпатч работает, сначала устанавливая базовый план с Центр обновления Windows последним накопительным обновлением. Хотпатчес периодически выпускаются (например, во второй вторник месяца), который строится на этом базовом плане. Хотпатчес будет содержать обновления, не требующие перезагрузки. Периодически (начиная с каждых трех месяцев) базовый план обновляется последним накопительным обновлением.

:::image type="content" source="media\automanage-hotpatch\hotpatch-sample-schedule.png" alt-text="Пример расписания хотпатч.":::

Существует два типа базовых показателей: **плановые базовые** планы и **незапланированные базовые планы**.
*  **Плановые базовые планы** выпускаются на регулярной частоте с хотпатч выпусками.  Плановые базовые планы включают все обновления в сравнимом _последнем накопительном обновлении_ для этого месяца и требует перезагрузки.
    * В приведенном выше примере расписания показаны четыре плановых базовых выпуска в календарном году (пять итогов на диаграмме) и восемь выпусков хотпатч.
* **Незапланированные базовые планы** выпускаются при выпуске важного обновления (например, исправление нулевого дня), которое не может быть выпущено как хотпатч.  При выпуске незапланированных базовых планов хотпатчный выпуск будет заменен на незапланированный базовый план в этом месяце.  Незапланированные базовые показатели также включают в себя все обновления в сравнимом _последнем накопительном обновлении_ для этого месяца, а также требует перезагрузки.
    * В приведенном выше примере расписания показаны два незапланированных базовых плана, которые заменяют выпуски хотпатч для этих месяцев (фактическое число незапланированных базовых планов в году не известно заранее).

## <a name="regional-availability"></a>Доступность по регионам
Хотпатч доступен во всех глобальных регионах Azure в предварительной версии. Регионы Azure для государственных организаций не поддерживаются в предварительной версии.

## <a name="how-to-get-started"></a>Начало работы

> [!NOTE]
> На этапе предварительной версии вы можете начать работу только в портал Azure с помощью [этой ссылки](https://aka.ms/AzureAutomanageHotPatch).

Чтобы приступить к использованию Хотпатч на новой виртуальной машине, выполните следующие действия.
1.  Включить предварительный доступ
    * Для каждой подписки требуется одноразовый доступ на предварительную версию.
    * Доступ к предварительной версии можно включить с помощью API, PowerShell или CLI, как описано в следующем разделе.
1.  Создание виртуальной машины из портал Azure
    * В ходе предварительной версии необходимо приступить к работе с [этой ссылкой](https://aka.ms/AzureAutomanageHotPatch).
1.  Сведения о виртуальной машине
    * Убедитесь, что в раскрывающемся списке изображение выбран _выпуск Windows Server 2019 Datacenter: Azure._
    * На шаге вкладка Управление прокрутите вниз до раздела "обновления гостевой ОС". Вы увидите, что для параметра HotPatching установлено значение ON, а установка исправления по умолчанию устанавливается в набор исправлений, управляемый Azure.
    * Рекомендации по управлению ВМ для управления виртуальной машиной будут включены по умолчанию
1. Создание новой виртуальной машины

## <a name="enabling-preview-access"></a>Включение доступа к предварительному просмотру

### <a name="rest-api"></a>REST API

В следующем примере показано, как включить предварительную версию для подписки.

```
POST on `/subscriptions/{subscriptionId}/providers/Microsoft.Features/providers/Microsoft.Compute/features/ InGuestHotPatchVMPreview/register?api-version=2015-12-01`
POST on `/subscriptions/{subscriptionId}/providers/Microsoft.Features/providers/Microsoft.Compute/features/InGuestAutoPatchVMPreview/register?api-version=2015-12-01`
POST on `/subscriptions/{subscriptionId}/providers/Microsoft.Features/providers/Microsoft.Compute/features/InGuestPatchVMPreview/register?api-version=2015-12-01`
```

Регистрация компонентов может занять до 15 минут. Чтобы проверить состояние регистрации, сделайте следующее:

```
GET on `/subscriptions/{subscriptionId}/providers/Microsoft.Features/providers/Microsoft.Compute/features/InGuestHotPatchVMPreview?api-version=2015-12-01`
GET on `/subscriptions/{subscriptionId}/providers/Microsoft.Features/providers/Microsoft.Compute/features/InGuestAutoPatchVMPreview?api-version=2015-12-01`
GET on `/subscriptions/{subscriptionId}/providers/Microsoft.Features/providers/Microsoft.Compute/features/InGuestPatchVMPreview?api-version=2015-12-01`
```

После регистрации функции для подписки завершите процесс согласия, добавив изменения в поставщик ресурсов вычислений.

```
POST on `/subscriptions/{subscriptionId}/providers/Microsoft.Compute/register?api-version=2019-12-01`
```

### <a name="azure-powershell"></a>Azure PowerShell

Используйте ```Register-AzProviderFeature``` командлет, чтобы включить предварительную версию для подписки.

``` PowerShell
Register-AzProviderFeature -FeatureName InGuestHotPatchVMPreview -ProviderNamespace Microsoft.Compute
Register-AzProviderFeature -FeatureName InGuestAutoPatchVMPreview -ProviderNamespace Microsoft.Compute
Register-AzProviderFeature -FeatureName InGuestPatchVMPreview -ProviderNamespace Microsoft.Compute
```

Регистрация компонентов может занять до 15 минут. Чтобы проверить состояние регистрации, сделайте следующее:

``` PowerShell
Get-AzProviderFeature -FeatureName InGuestHotPatchVMPreview -ProviderNamespace Microsoft.Compute
Get-AzProviderFeature -FeatureName InGuestAutoPatchVMPreview -ProviderNamespace Microsoft.Compute
Get-AzProviderFeature -FeatureName InGuestPatchVMPreview -ProviderNamespace Microsoft.Compute
```

После регистрации функции для подписки завершите процесс согласия, добавив изменения в поставщик ресурсов вычислений.

``` PowerShell
Register-AzResourceProvider -ProviderNamespace Microsoft.Compute
```

### <a name="azure-cli"></a>Azure CLI

Используйте ```az feature register``` , чтобы включить предварительную версию для подписки.

```
az feature register --namespace Microsoft.Compute --name InGuestHotPatchVMPreview
az feature register --namespace Microsoft.Compute --name InGuestAutoPatchVMPreview
az feature register --namespace Microsoft.Compute --name InGuestPatchVMPreview
```

Регистрация компонентов может занять до 15 минут. Чтобы проверить состояние регистрации, сделайте следующее:
```
az feature show --namespace Microsoft.Compute --name InGuestHotPatchVMPreview
az feature show --namespace Microsoft.Compute --name InGuestAutoPatchVMPreview
az feature show --namespace Microsoft.Compute --name InGuestPatchVMPreview
```

После регистрации функции для подписки завершите процесс согласия, добавив изменения в поставщик ресурсов вычислений.

```
az provider register --namespace Microsoft.Compute
```

## <a name="patch-installation"></a>Установка исправлений

Во время действия предварительной версии [Автоматическая установка исправлений гостевых виртуальных машин](https://docs.microsoft.com/azure/virtual-machines/automatic-vm-guest-patching) включается автоматически для всех виртуальных машин, созданных с помощью _Windows Server 2019 Datacenter: выпуск Azure_. С включенной автоматической установкой исправлений гостевых виртуальных машин:
* Исправления, классифицированные как критические, или безопасность, автоматически загружаются и применяются к виртуальной машине.
* Исправления применяются в часы наименьшей нагрузки в часовом поясе виртуальной машины.
* Управление исправлениями осуществляется с помощью Azure, а исправления применяются после [принципов доступности](https://docs.microsoft.com/azure/virtual-machines/automatic-vm-guest-patching#availability-first-patching).
* Отслеживание работоспособности виртуальной машины, которое определяется с помощью сигналов работоспособности платформы, отслеживается для обнаружения сбоев исправления.

### <a name="how-does-automatic-vm-guest-patching-work"></a>Как работает автоматическая установка исправлений гостевых виртуальных машин?

Если [Автоматическая установка исправлений гостевых виртуальных машин](https://docs.microsoft.com/azure/virtual-machines/automatic-vm-guest-patching) включена на виртуальной машине, доступные критически важные обновления и исправления безопасности загружаются и применяются автоматически. Этот процесс начинается автоматически каждый месяц при выпуске новых исправлений. Оценка и установка исправлений выполняются автоматически, и процесс включает перезагрузку виртуальной машины по мере необходимости.

Если Хотпатч включен в _Windows Server 2019 Datacenter: виртуальные машины Azure Edition_ , большинство ежемесячных обновлений безопасности доставляются как хотпатчес, которые не нуждаются в перезагрузках. Для последних накопительных обновлений, отправленных в запланированные или незапланированные базовые месяцы, потребуется перезагрузка виртуальных машин. Дополнительные критические обновления или исправления безопасности могут быть также периодически доступны, что может потребовать перезагрузки виртуальных машин.

Виртуальная машина оценивается автоматически каждые несколько дней и несколько раз в течение любого 30-дневного периода, чтобы определить применимые исправления для этой виртуальной машины. Эта автоматическая оценка гарантирует, что все отсутствующие исправления будут обнаружены по самой ранней возможной возможности.

Исправления устанавливаются в течение 30 дней после ежемесячных выпусков исправлений, а также в рамках [первых принципов доступности](https://docs.microsoft.com/azure/virtual-machines/automatic-vm-guest-patching#availability-first-patching). Исправления устанавливаются только в часы наименьшей нагрузки для виртуальной машины в зависимости от часового пояса виртуальной машины. Для автоматической установки исправлений виртуальная машина должна быть запущена в часы наименьшей нагрузки. Если виртуальная машина отключена во время периодической оценки, то проверка и применимые исправления будут автоматически устанавливаться во время следующей периодической оценки, когда виртуальная машина будет включена. Следующая периодическая оценка обычно происходит в течение нескольких дней.

Обновления определений и другие исправления, не классифицированные как критические, или безопасность не будут устанавливаться с помощью автоматического исправления гостевых виртуальных машин.

## <a name="understanding-the-patch-status-for-your-vm"></a>Основные сведения о состоянии исправления для виртуальной машины

Чтобы просмотреть состояние исправления для виртуальной машины, перейдите к разделу **Гостевые и обновления узлов** для виртуальной машины в портал Azure. В разделе **обновления гостевой ОС** щелкните "перейти к Хотпатч (Предварительная версия)", чтобы просмотреть Последнее состояние исправления для виртуальной машины.

На этом экране вы увидите состояние Хотпатч для виртуальной машины. Также можно проверить наличие доступных исправлений для виртуальной машины, которая не была установлена. Как описано в разделе «Установка исправлений» выше, все критические обновления и безопасность будут автоматически установлены на виртуальной машине с помощью [автоматического исправления гостевых виртуальных машин](https://docs.microsoft.com/azure/virtual-machines/automatic-vm-guest-patching) , и никаких дополнительных действий не требуется. Исправления с другими классификациями обновлений не устанавливаются автоматически. Вместо этого они отображаются в списке доступных исправлений на вкладке "соответствие обновлениям". Вы также можете просмотреть историю развертываний обновлений на виртуальной машине с помощью журнала обновлений. Отображается журнал обновлений за последние 30 дней, а также сведения об установке исправлений.


:::image type="content" source="media\automanage-hotpatch\hotpatch-management-ui.png" alt-text="Управление хотпатч.":::

При автоматическом обновлении гостевых виртуальных машин виртуальная машина периодически обновляется и автоматически оценивается на наличие доступных обновлений. Эти периодические оценки гарантируют, что будут обнаружены доступные исправления. Результаты оценки можно просмотреть на экране обновлений выше, включая время последней оценки. Вы также можете активировать оценку исправления по запросу для виртуальной машины в любое время с помощью параметра "оценить сейчас" и проверить результаты после завершения оценки.

Как и при оценке по запросу, можно также установить исправления по запросу для виртуальной машины с помощью параметра "установить обновления сейчас". Здесь можно выбрать установку всех обновлений в соответствии с конкретными классификациями исправлений. Можно также указать обновления для включения или исключения, предоставив список отдельных статей базы знаний. Исправления, установленные по запросу, не устанавливаются с использованием принципов обеспечения доступности и могут потребовать дополнительных перезагрузок и простоя виртуальной машины для установки обновлений.

## <a name="supported-updates"></a>Поддерживаемые обновления

Хотпатч охватывает обновления системы безопасности Windows и обеспечивает их соответствие содержимому обновлений безопасности, выпущенных в обычном канале обновления Windows (не Хотпатч).

Существует ряд важных вопросов, касающихся запуска виртуальной машины Windows Server Azure Edition с включенным Хотпатч. Для установки обновлений, которые не включены в программу Хотпатч, все еще требуется перезагрузка. Перезагрузка также требуется периодически после установки нового базового плана. Эти перезагрузки сохраняют синхронизацию виртуальной машины с исправлениями, не являющимися обновлениями безопасности, включенными в последнее накопительное обновление.
* Исправления, которые в настоящее время не включены в программу Хотпатч, включают обновления, не относящиеся к безопасности, выпущенные для Windows, и обновления, отличные от Windows (например, исправления .NET).  Эти типы исправлений необходимо установить в течение месяца по базовому плану и потребуют перезагрузки.

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

### <a name="what-is-hotpatching"></a>Что такое HotPatching?

* Обновление HotPatching — это новый способ установки обновлений в Windows Server 2019 Datacenter: виртуальная машина Azure Edition в Azure, которая не требует перезагрузки после установки. Он работает путем исправления кода в памяти выполняющихся процессов без необходимости перезапуска процесса.

### <a name="how-does-hotpatching-work"></a>Как работает функция HotPatching?

* Функция HotPatching работает путем создания базового плана с Центр обновления Windows последним накопительным обновлением, а затем строится на основе этого базового уровня с обновлениями, для которых не требуется перезагрузка.  Базовый план периодически обновляется с помощью нового накопительного обновления. Накопительное обновление включает все обновления безопасности и качества, а также требует перезагрузки.

### <a name="why-should-i-use-hotpatch"></a>Зачем использовать Хотпатч?

* При использовании Хотпатч в Windows Server 2019 Datacenter: выпуск Azure, виртуальная машина будет иметь более высокий уровень доступности (меньше перезагрузок) и более быстрые обновления (меньшие пакеты, которые устанавливаются быстрее, без необходимости перезапуска процессов). В результате этого процесса виртуальная машина будет всегда обновлена и защищена.

### <a name="what-types-of-updates-are-covered-by-hotpatch"></a>Какие типы обновлений охватывает Хотпатч?

* Хотпатч в настоящее время охватывает обновления безопасности Windows.

### <a name="when-will-i-receive-the-first-hotpatch-update"></a>Когда будет получено первое обновление Хотпатч?

* Обновления хотпатч обычно выпускаются во второй вторник каждого месяца. Дополнительные сведения приведены ниже.

### <a name="what-will-the-hotpatch-schedule-look-like"></a>Как будет выглядеть расписание Хотпатч?

* Функция HotPatching работает путем создания базового плана с Центр обновления Windows последним накопительным обновлением, а затем строится на основе этого базового уровня с Хотпатч обновлениями, выпущенными ежемесячно.  В течение предварительной версии базовые показатели будут выпущены каждые три месяца. На рисунке ниже приведен пример ежегодного расписания в три месяца (включая примеры незапланированных базовых планов из-за исправлений, отшедших от 0 дней).

    :::image type="content" source="media\automanage-hotpatch\hotpatch-sample-schedule.png" alt-text="Пример расписания хотпатч.":::

### <a name="are-reboots-still-needed-for-a-vm-enrolled-in-hotpatch"></a>Все еще требуется перезагрузка для виртуальной машины, зарегистрированной в Хотпатч?

* Перезагрузка по-прежнему необходима для установки обновлений, не включенных в программу Хотпатч, и периодически требуется после установки базовых показателей (Центр обновления Windows Последнее накопительное обновление). Эта перезагрузка обеспечит синхронизацию виртуальной машины со всеми исправлениями, входящими в накопительное обновление. Базовые показатели (требующие перезагрузки) будут запускаться в течение трех месяцев и увеличиваться со временем.

### <a name="are-my-applications-affected-when-a-hotpatch-update-is-installed"></a>Затронуты ли мои приложения при установке обновления Хотпатч?

* Поскольку Хотпатч выполняет исправление кода в памяти выполняющихся процессов без необходимости перезапуска процесса, процесс установки исправлений на приложения не повлияет. Обратите внимание, что это отдельно от любых потенциальных последствий в отношении производительности и функциональности самого исправления.

### <a name="can-i-turn-off-hotpatch-on-my-vm"></a>Можно ли отключить Хотпатч на моей виртуальной машине?

* Вы можете отключить Хотпатч на виртуальной машине с помощью портал Azure.  При отключении Хотпатч будет отменена регистрация виртуальной машины из Хотпатч, которая вернет виртуальную машину к обычному режиму обновления для Windows Server.  После отмены регистрации в Хотпатч на виртуальной машине вы можете повторно зарегистрировать эту виртуальную машину при выпуске следующего Хотпатч базового плана.

### <a name="can-i-upgrade-from-my-existing-windows-server-os"></a>Можно ли обновить существующую ОС Windows Server?

* Обновление существующих версий Windows Server (то есть Windows Server 2016 или 2019, не являющихся выпусками Azure) в настоящее время не поддерживается. Будет поддерживаться обновление до будущих выпусков Windows Server Azure Edition.

### <a name="can-i-use-hotpatch-for-production-workloads-during-the-preview"></a>Можно ли использовать Хотпатч для рабочих нагрузок в предварительной версии?

* Предварительные версии предназначены только для тестирования, но не для использования в рабочих средах.

### <a name="will-i-be-charged-during-the-preview"></a>Будет ли я начисляться за использование предварительной версии?

* Лицензия на выпуск Windows Server Azure предоставляется бесплатно в предварительной версии. Однако стоимость любой базовой инфраструктуры, настроенной для виртуальной машины (хранилища, вычислений, сети и т. д.), будет по-прежнему взимается в вашу подписку.

### <a name="how-can-i-get-troubleshooting-support-for-hotpatching"></a>Как можно получить поддержку по устранению неполадок HotPatching?

* Вы можете обменять [билет обращения в службу технической поддержки](https://portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/newsupportrequest). Для параметра служба найдите и выберите **виртуальную машину под управлением Windows** в разделе вычислений. Выберите **компоненты Azure** для типа проблемы и **Автоматическое исправление гостевой виртуальной машины** для подтипа проблемы.

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения об Azure [Управление обновлениями.](https://docs.microsoft.com/azure/automation/update-management/overview)
* Дополнительные сведения об автоматической установке исправлений гостевых виртуальных машин см. [здесь](https://docs.microsoft.com/azure/virtual-machines/automatic-vm-guest-patching)