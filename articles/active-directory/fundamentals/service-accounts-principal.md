---
title: Защита субъектов-служб в Azure Active Directory
description: Поиск, оценка и защита субъектов-служб.
services: active-directory
author: BarbaraSelden
manager: daveba
ms.service: active-directory
ms.workload: identity
ms.subservice: fundamentals
ms.topic: conceptual
ms.date: 2/15/2021
ms.author: baselden
ms.reviewer: ajburnle
ms.custom: it-pro, seodec18
ms.collection: M365-identity-device-management
ms.openlocfilehash: 1c9df24a255d640c463bd62e8bdfe8a576df3b09
ms.sourcegitcommit: c27a20b278f2ac758447418ea4c8c61e27927d6a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101693242"
---
# <a name="securing-service-principals"></a>Защита субъектов-служб

[Субъект-служба](https://docs.microsoft.com/azure/active-directory/develop/app-objects-and-service-principals) Azure Active Directory (Azure AD) — это локальное представление объекта приложения в одном клиенте или каталоге.  Он выступает в качестве удостоверения экземпляра приложения. Субъекты-службы определяют, кто может получить доступ к приложению, а также ресурсы, к которым приложение может получить доступ. Субъект-служба создается в каждом клиенте, где используется приложение, и ссылается на глобальный уникальный объект приложения. Клиент защищает вход субъекта-службы и доступ к ресурсам.  

### <a name="tenant-service-principal-relationships"></a>Отношения субъекта-службы клиента
Приложение с одним клиентом имеет только одного субъекта-службы в своем домашнем клиенте. Для веб-приложения или API с несколькими клиентами требуется субъект службы в каждом клиенте. Субъект-служба создается, когда пользователь из этого клиента придается к использованию приложением или API. Это согласие создает связь "один ко многим" между приложением с несколькими клиентами и связанными с ним субъектами-службами.

Приложение с несколькими клиентами размещается в одном клиенте и предназначено для экземпляров в других клиентах. Большинство приложений SaaS предназначены для поддержки нескольких. Используйте субъекты-службы, чтобы обеспечить правильную безопасность приложения и его пользователей в сценариях с одним клиентом и в нескольких клиентах.

## <a name="applicationid-and-objectid"></a>ApplicationID и ObjectID

У данного экземпляра приложения есть два различных свойства: ApplicationID (также известный как ClientID) и ObjectID.

> [!NOTE] 
> Может оказаться, что термины «приложение» и «субъект-служба» используются взаимозаменяемыми при нестрогой ссылке на приложение в контексте задач, связанных с проверкой подлинности. Однако это два различных представления приложений в Azure AD.
 

ApplicationID представляет глобальное приложение и одинаково для всех экземпляров приложения в разных клиентах. ObjectID — это уникальное значение для объекта приложения, представляющее субъект-службу. Как и в случае с пользователями, группами и другими ресурсами, ObjectID помогает однозначно идентифицировать экземпляр приложения в Azure AD.

Более подробные сведения по этой теме см. в разделе [связь приложения и субъекта-службы](https://docs.microsoft.com/azure/active-directory/develop/app-objects-and-service-principals).

Кроме того, в клиенте можно создать приложение и его объект субъекта-службы (ObjectID), используя Azure PowerShell, Azure CLI, Microsoft Graph, портал Azure и другие средства. 

![Снимок экрана, показывающий новую регистрацию приложения с выделенными полями идентификатор приложения и идентификатор объекта.](./media/securing-service-accounts/secure-principal-image-1.png)

## <a name="service-principal-authentication"></a>Проверка подлинности субъекта-службы

Существует два механизма проверки подлинности с помощью субъектов-служб — клиентских сертификатов и секретов клиента. 

![ Снимок экрана: страница "Создание приложения" с выделенными сертификатами и секретными областями клиента.](./media/securing-service-accounts/secure-principal-certificates.png)

Сертификаты более безопасны: по возможности используйте сертификаты клиентов. В отличие от секретов клиента, клиентские сертификаты не могут быть случайно внедрены в код. Используйте Azure Key Vault для управления сертификатами и секретами, если это возможно для шифрования следующих ресурсов с помощью ключей, защищенных аппаратными модулями безопасности:

* ключи проверки подлинности

* ключи учетной записи хранения

* ключи шифрования данных

* PFX-файлы;

* Пароли 

Дополнительные сведения о Azure Key Vault и их использовании для управления сертификатами и секретами см. в статьях [о Azure Key Vault](https://docs.microsoft.com/azure/key-vault/general/overview) и [назначении политики Key Vault доступа с помощью портал Azure](https://docs.microsoft.com/azure/key-vault/general/assign-access-policy-portal). 

 ### <a name="challenges-and-mitigations"></a>Проблемы и способы их устранения
В следующей таблице представлены способы устранения проблем, с которыми вы можете столкнуться при использовании субъектов-служб.


| Сложности| Устранение проблем |
| - | - |
| Проверки доступа для субъектов-служб, назначенных привилегированным ролям.| Эта функция доступна в предварительной версии и пока недоступна. |
| Проверяет доступ субъектов-служб| Проверка списка управления доступом ресурса вручную с помощью портал Azure. |
| Через разрешения субъектов-служб| При создании учетных записей службы автоматизации или субъектов-служб предоставьте только те разрешения, которые необходимы для задачи. Оцените существующие субъекты-службы, чтобы узнать, можно ли уменьшить привилегии. |
|Идентификация изменений для учетных данных субъектов-служб или методов проверки подлинности |Используйте книгу отчетов с конфиденциальными операциями, что поможет устранить эту ошибку. [См. описание в этой записи блога](https://techcommunity.microsoft.com/t5/azure-active-directory-identity/azure-ad-workbook-to-help-you-assess-solorigate-risk/ba-p/2010718).|

## <a name="find-accounts-using-service-principals"></a>Поиск учетных записей с помощью субъектов-служб
Выполните следующие команды, чтобы найти учетные записи с помощью субъектов-служб.

Использование Azure CLI


`az ad sp list`

Использование PowerShell

`Get-AzureADServicePrincipal -All:$true` 


Дополнительные сведения см. в разделе [Get-AzureADServicePrincipal](https://docs.microsoft.com/powershell/module/azuread/get-azureadserviceprincipal?view=azureadps-2.0) .

## <a name="assess-service-principal-security"></a>Оценка безопасности субъекта-службы

Чтобы оценить безопасность субъектов-служб, убедитесь, что вы оценили привилегии и хранилище учетных данных.

Используйте следующие сведения для устранения потенциальных проблем.
|Сложности | Устранение проблем|
| - | - |
| Обнаружение пользователя, который не отправлялся в многоклиентское приложение, и обнаружение незаконных предоставлений согласия для приложения с несколькими клиентами | Запустите следующую команду PowerShell, чтобы найти приложения с несколькими клиентами.<br>`Get-AzureADServicePrincipal -All:$true ? {$_.Tags -eq WindowsAzureActiveDirectoryIntegratedApp"}`<br>Отключить согласие пользователя. <br>Разрешить согласие пользователя от проверенных издателей для выбранных разрешений (рекомендуется) <br> Используйте условный доступ для блокировки субъектов-служб из ненадежных расположений. Настройте их в контексте пользователя, и их токены следует использовать для активации субъекта-службы.|
|Использование жестко запрограммированного общего секрета в скрипте с помощью субъекта-службы.|Используйте сертификат или Azure Key Vault.|
|Отслеживание того, кто использует сертификат или секрет| Отслеживайте вход субъекта-службы с помощью журналов входа в Azure AD.|
Не может управлять входом субъектов-служб с помощью условного доступа.| Мониторинг входа с помощью журналов входа в Azure AD
| Роль RBAC Azure по умолчанию — участник. |Оцените потребности и примените роль с минимально возможными разрешениями для удовлетворения этой потребности.|

## <a name="move-from-a-user-account-to-a-service-principal"></a>Переход от учетной записи пользователя к субъекту-службе  
Если вы используете учетную запись пользователя Azure в качестве субъекта-службы, оцените, можно ли перейти на [управляемое удостоверение](https://docs.microsoft.com/azure/app-service/overview-managed-identity?tabs=dotnet) или субъект-службу. Если вы не можете использовать управляемое удостоверение, подготавливаете субъект-службу, имеющую достаточно разрешений и область действия для выполнения необходимых задач. Чтобы создать субъект-службу, можно [зарегистрировать приложение](https://docs.microsoft.com/azure/active-directory/develop/howto-create-service-principal-portal)или [PowerShell](https://docs.microsoft.com/azure/active-directory/develop/howto-authenticate-service-principal-powershell).

При использовании Microsoft Graph просмотрите документацию по конкретному API, [как в этом примере](https://docs.microsoft.com/powershell/azure/create-azure-service-principal-azureps?view=azps-5.0.0), и убедитесь, что тип разрешения для приложения отображается как поддерживаемый.

## <a name="next-steps"></a>Дальнейшие действия

**Дополнительные сведения о субъектах-службах:**

[Создание субъекта-службы](../develop/howto-create-service-principal-portal.md)

 [Мониторинг входа субъекта-службы](../reports-monitoring/concept-all-sign-ins#sign-ins-report.md)

**Дополнительные сведения о защите учетных записей служб:**

[Общие сведения об учетных записях служб Azure](service-accounts-introduction-azure.md)

[Защита управляемых удостоверений](service-accounts-managed-identities.md)

[Управление учетными записями служб Azure](service-accounts-governing-azure.md)

[Вводные сведения о локальных учетных записях служб](service-accounts-on-poremises.md)
