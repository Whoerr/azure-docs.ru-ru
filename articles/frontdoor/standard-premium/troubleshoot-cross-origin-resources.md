---
title: Использование передней дверцы Azure уровня "Стандартный" или "Премиум" с общим доступом к ресурсам между источниками
description: Узнайте, как использовать переднюю дверцу Azure (АФД) для совместного использования ресурсов в разных источниках (CORS).
services: frontdoor
author: duongau
ms.service: frontdoor
ms.topic: how-to
ms.date: 02/18/2021
ms.author: qixwang
ms.openlocfilehash: ee8f19aca62d2e331fcf59551d47c2dac93783b1
ms.sourcegitcommit: 97c48e630ec22edc12a0f8e4e592d1676323d7b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/18/2021
ms.locfileid: "101099371"
---
# <a name="using-azure-front-door-standardpremium-with-cross-origin-resource-sharing-cors"></a>Использование передней дверцы Azure уровня "Стандартный" или "Премиум" с общим доступом к ресурсам между источниками (CORS)

> [!Note]
> Эта документация предназначена для передней дверцы Azure уровня "Стандартный" или "Премиум" (Предварительная версия). Ищете информацию о передней дверце Azure? Просмотреть [здесь](../front-door-overview.md).

## <a name="what-is-cors"></a>Что такое CORS?

CORS (общий доступ к ресурсам независимо от источника) — функция HTTP, которая позволяет веб-приложению, работающему в одном домене, обращаться к ресурсам другого домена. Чтобы снизить вероятность атак с использованием межузловых сценариев, все современные веб-браузеры реализуют ограничение безопасности, известное как [Политика того же происхождения](https://www.w3.org/Security/wiki/Same_Origin_Policy). Это ограничение не позволяет веб-страницы вызывать интерфейсы API в другом домене.  CORS позволяет одному источнику (исходному домену) безопасно вызывать интерфейсы API в другом источнике.

> [!IMPORTANT]
> Передняя дверца Azure Standard/Premium (Предварительная версия) в настоящее время доступна в общедоступной предварительной версии.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены.
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="how-it-works"></a>Принцип работы

Существует два типа запросов CORS, *простые запросы* и *сложные запросы*.

### <a name="for-simple-requests"></a>Простые запросы

1. Браузер отправляет запрос CORS с другим заголовком HTTP-запроса **источника** . Значение этого заголовка является источником, обслужившим родительскую страницу, который определяется как сочетание *протокола,* *домена* и *порта*.  Когда страница из HTTPS \: //www.contoso.com пытается получить доступ к данным пользователя в источнике Fabrikam.com, в Fabrikam.com будет отправлен следующий заголовок запроса:

   `Origin: https://www.contoso.com`

2. Сервер может отправить в ответ следующее:

   * Ответ с заголовком **Access-Control-Allow-Origin**, который указывает, какие исходные сайты разрешены. Пример:

     `Access-Control-Allow-Origin: https://www.contoso.com`

   * Код ошибки HTTP, например 403, если сервер не разрешает запрос между источниками после проверки заголовка источника.

   * Заголовок **Access-Control-Allow-Origin** с подстановочным знаком, который разрешает все источники:

     `Access-Control-Allow-Origin: *`

### <a name="for-complex-requests"></a>Сложные запросы

Сложный запрос — это запрос CORS, для выполнения которого браузер должен отправить *предварительный запрос* (т. е. выполнить предварительную проверку) перед отправкой самого запроса CORS. Предпечатный запрос запрашивает разрешение на сервер, если исходный запрос CORS может продолжать работу и является `OPTIONS` запросом к тому же URL-адресу.

> [!TIP]
> Дополнительные сведения о процедурах CORS и типичных проблемах доступны в [руководстве по CORS для REST API](https://www.moesif.com/blog/technical/cors/Authoritative-Guide-to-CORS-Cross-Origin-Resource-Sharing-for-REST-APIs/).
>
>

## <a name="wildcard-or-single-origin-scenarios"></a>Подстановочный знак или сценарии с одним источником
CORS на передней дверце Azure будет работать автоматически без дополнительной настройки, если в заголовке **Access-Control-Allow-Origin** задан подстановочный знак (*) или один источник.  Передняя дверца Azure будет кэшировать первый ответ, и при этом запросы будут использовать тот же заголовок.

Если перед установкой CORS в источнике уже были сделаны запросы к начальной дверце Azure, вам потребуется очистить содержимое конечной точки, чтобы перезагрузить содержимое с заголовком **Access-Control-Allow-Origin** .

## <a name="multiple-origin-scenarios"></a>Сценарии с несколькими источниками
Если необходимо разрешить для CORS определенный набор источников, задача несколько усложняется. Проблема возникает, когда CDN кэширует заголовок **Access-Control-Allow-Origin** для первого источника CORS.  Когда другой источник CORS делает другой запрос, CDN будет обслуживать кэшированный заголовок **Access-Control-Allow-Origin** , который не будет совпадать. Существует несколько способов устранения этой проблемы.

### <a name="azure-front-door-rule-set"></a>Набор правил для передней дверцы Azure

На передней дверце Azure вы можете создать правило в [наборе правил](concept-rule-set.md) для передней дверцы Azure, чтобы проверить заголовок **источника** в запросе. Если это допустимый источник, то правило установит в качестве заголовка **Access-Control-Allow-Origin** правильное значение. В этом случае заголовок **Access-Control-Allow-Origin** от сервера-источника файла игнорируется, а обработчик правил АФД полностью управляет разрешенными источниками CORS.

:::image type="content" source="../media/troubleshooting-cross-origin-resource-sharing/cross-origin-resource.png" alt-text="Снимок экрана с примером правил с набором правил.":::

> [!TIP]
> К правилу можно добавить дополнительные действия для изменения дополнительных заголовков ответа, таких как **Access-Control-Allow-Methods**.
> 

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о [создании Front Door](create-front-door-portal.md).
