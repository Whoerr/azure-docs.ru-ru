---
title: Использование Политики Azure для применения конфигураций кластера в требуемом масштабе
services: azure-arc
ms.service: azure-arc
ms.date: 03/02/2021
ms.topic: article
author: mlearned
ms.author: mlearned
description: Использование Политики Azure для применения конфигураций кластера в требуемом масштабе
keywords: Kubernetes, Arc, Azure, K8s, контейнеры
ms.openlocfilehash: 7f85050666c383ba49730bd88ce1f26d55607e7a
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2021
ms.locfileid: "101652153"
---
# <a name="use-azure-policy-to-apply-cluster-configurations-at-scale"></a>Использование Политики Azure для применения конфигураций кластера в требуемом масштабе

## <a name="overview"></a>Обзор

Вы можете использовать политику Azure для применения конфигураций ( `Microsoft.KubernetesConfiguration/sourceControlConfigurations` тип ресурса) в службе "геомасштабирование" в Kubernetes кластерах с поддержкой ARC ( `Microsoft.Kubernetes/connectedclusters` ).

Чтобы использовать политику Azure, выберите существующее определение политики и Создайте назначение политики. При создании назначения политики:
1. Задайте область для назначения.
    * Областью действия будет группа ресурсов или подписка Azure. 
2. Задайте параметры конфигурации, которые будут созданы. 

После создания назначения обработчик политик Azure определяет все кластеры Kubernetes, включенные в эту область, и применяет конфигурацию к каждому кластеру.

Можно создать несколько конфигураций, каждый из которых указывает на другой репозиторий Git, используя несколько назначений политик. Например, один репозиторий для центрального оператора ИТ/кластера и других репозиториев для групп приложений.

## <a name="prerequisite"></a>Предварительное требование

Убедитесь, что у вас есть `Microsoft.Authorization/policyAssignments/write` разрешения на доступ к области (подписке или группе ресурсов), где вы создадите это назначение политики.

## <a name="create-a-policy-assignment"></a>Создание назначения политики

1. В портал Azure перейдите к **политике**.
1. В разделе **Разработка** боковой панели выберите **определения**.
1. В категории "Kubernetes" выберите встроенную политику "развернуть Гитопс в кластере Kubernetes". 
1. Щелкните **Назначить**.
1. Укажите в качестве **области** группу управления, подписку или группу ресурсов, к которым будет применяться назначение политики.
    * Если требуется исключить все ресурсы из области политики, задайте **исключения**.
1. Присвойте назначению политики легко узнаваемое **имя** и **Описание**.
1. Убедитесь, что для **применения политики** задано значение **включено**.
1. Выберите **Далее**.
1. Задайте значения параметров, которые будут использоваться при создании `sourceControlConfiguration` .
1. Выберите **Далее**.
1. Включите параметр **Создание задачи исправления**.
1. Убедитесь, что установлен флажок **создать управляемое удостоверение** и что удостоверение будет иметь разрешения **участника** . 
    * Дополнительные сведения см. в статье [Создание назначения политики](../../governance/policy/assign-policy-portal.md) и [исправление несоответствующих ресурсов с помощью политики Azure](../../governance/policy/how-to/remediate-resources.md).
1. Выберите **Review + create** (Просмотреть и создать).

После создания назначения политики конфигурация применяется к новым кластерам Kubernetes, поддерживающим службу "Дуга Azure", созданным в области назначения политики.

Для существующих кластеров необходимо вручную запустить задачу исправления. Для того чтобы назначение политики вступило в силу, эта задача обычно занимает от 10 до 20 минут.

## <a name="verify-a-policy-assignment"></a>Проверка назначения политики

1. В портал Azure перейдите к одному из Kubernetes кластеров Azure, для которых включена служба "Дуга".
1. В разделе **Параметры** боковой панели выберите **политики**. 
    * В списке политики вы увидите созданное ранее назначение политики с **состоянием соответствия** , установленным как *соответствующее*.
1. В разделе **Параметры** боковой панели выберите пункт **Конфигурации**.
    * В списке конфигурации вы увидите конфигурацию, созданную назначением политики.
1. Используйте `kubectl` для опроса кластера. 
    * Вы должны увидеть пространство имен и артефакты, созданные ресурсами конфигурации.
    * В течение 5 минут (предполагая, что кластер имеет сетевое подключение к Azure) вы должны увидеть объекты, описанные в манифестах в репозитории Git, чтобы создать кластер.

## <a name="next-steps"></a>Дальнейшие действия

* [Настройка Azure Monitor для контейнеров с кластерами Kubernetes с поддержкой Arc](../../azure-monitor/containers/container-insights-enable-arc-enabled-clusters.md)
